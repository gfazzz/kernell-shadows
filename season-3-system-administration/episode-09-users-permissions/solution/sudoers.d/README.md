# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ sudo –¥–ª—è –∫–æ–º–∞–Ω–¥—ã –æ–ø–µ—Ä–∞—Ü–∏–∏
## Episode 09: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

> *"Root access –∫–∞–∫ –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–π –ø–∏—Å—Ç–æ–ª–µ—Ç. –ù–µ –¥–∞–≤–∞–π –µ–≥–æ –∫–æ–º—É –ø–æ–ø–∞–ª–æ."*
> ‚Äî –ê–Ω–¥—Ä–µ–π –í–æ–ª–∫–æ–≤, –õ–≠–¢–ò

---

## üìÅ –§–∞–π–ª—ã –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ

### `alex` ‚Äî –ê–ª–µ–∫—Å –°–æ–∫–æ–ª–æ–≤ (–°–µ—Ç–µ–≤–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
**–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã: `ip`, `ss`, `netstat`, `tcpdump`
- –§–∞–µ—Ä–≤–æ–ª: `iptables`, `ufw`
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: `nmap`, `traceroute`, `mtr`

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (`useradd`, `passwd root`)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ sudo –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`visudo`)
- –î–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`rm -rf /`)

**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (Principle of Least Privilege)

---

### `anna` ‚Äî –ê–Ω–Ω–∞ –ö–æ–≤–∞–ª–µ–≤–∞ (–ö—Ä–∏–º–∏–Ω–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–µ—Ä—Ç)
**–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤: `less`, `tail`, `cat`, `grep` –¥–ª—è `/var/log/*`
- –ñ—É—Ä–Ω–∞–ª systemd: `journalctl`
- –ê—Ä—Ö–∏–≤–Ω—ã–µ –ª–æ–≥–∏: `zgrep`, `zcat`

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ (–ª—é–±—ã–µ write –æ–ø–µ—Ä–∞—Ü–∏–∏)
- –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ (`rm`, `truncate`)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** Read-only –¥–æ—Å—Ç—É–ø –¥–ª—è forensics (—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤)

---

### `dmitry` ‚Äî –î–º–∏—Ç—Ä–∏–π –û—Ä–ª–æ–≤ (DevOps –∏–Ω–∂–µ–Ω–µ—Ä)
**–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏: `systemctl start/stop/restart/status`
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤: `journalctl`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏: `kill`, `pkill`, `htop`
- Docker: `docker`, `docker-compose`

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ sudo –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –î–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** Separation of duties (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π)

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤ /etc/sudoers.d/
sudo cp alex /etc/sudoers.d/alex
sudo cp anna /etc/sudoers.d/anna
sudo cp dmitry /etc/sudoers.d/dmitry
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```bash
# –ü—Ä–∞–≤–∞ 440 (read-only –¥–ª—è root –∏ –≥—Ä—É–ø–ø—ã, –Ω–∏—á–µ–≥–æ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö)
sudo chmod 440 /etc/sudoers.d/alex
sudo chmod 440 /etc/sudoers.d/anna
sudo chmod 440 /etc/sudoers.d/dmitry
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (–ö–†–ò–¢–ò–ß–ù–û!)
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
sudo visudo -c -f /etc/sudoers.d/alex
sudo visudo -c -f /etc/sudoers.d/anna
sudo visudo -c -f /etc/sudoers.d/dmitry

# –ï—Å–ª–∏ OK ‚Äî —É–≤–∏–¥–∏—à—å —Å–æ–æ–±—â–µ–Ω–∏–µ "parsed OK"
# –ï—Å–ª–∏ ERROR ‚Äî –ù–ï –ü–†–û–î–û–õ–ñ–ê–ô! –ò—Å–ø—Ä–∞–≤—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å!
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –û—à–∏–±–∫–∞ –≤ sudoers —Ñ–∞–π–ª–µ –º–æ–∂–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å sudo**!
–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —á–µ—Ä–µ–∑ `visudo -c` –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π!

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ sudoers.d –≤–∫–ª—é—á—ë–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ñ–∞–π–ª–µ
grep "^#includedir /etc/sudoers.d" /etc/sudoers

# –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤—å –≤ /etc/sudoers:
# echo "#includedir /etc/sudoers.d" | sudo tee -a /etc/sudoers
```

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ê–ª–µ–∫—Å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–µ—Ç–µ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –£—Å–ø–µ—Ö (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)
sudo -u alex sudo ip addr show
sudo -u alex sudo ss -tulpn
sudo -u alex sudo iptables -L

# –û—à–∏–±–∫–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–æ)
sudo -u alex sudo useradd test
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "Sorry, user alex is not allowed to execute..."
```

### –¢–µ—Å—Ç 2: –ê–Ω–Ω–∞ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏, –Ω–æ –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å
```bash
# –£—Å–ø–µ—Ö (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)
sudo -u anna sudo cat /var/log/auth.log
sudo -u anna sudo journalctl -u ssh --since today
sudo -u anna sudo grep "Failed" /var/log/auth.log

# –û—à–∏–±–∫–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–æ)
sudo -u anna sudo rm /var/log/auth.log
sudo -u anna sudo bash -c 'echo "fake" >> /var/log/auth.log'
```

### –¢–µ—Å—Ç 3: –î–º–∏—Ç—Ä–∏–π –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –£—Å–ø–µ—Ö (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)
sudo -u dmitry sudo systemctl status nginx
sudo -u dmitry sudo journalctl -u nginx -n 50
sudo -u dmitry sudo docker ps

# –û—à–∏–±–∫–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–æ)
sudo -u dmitry sudo useradd test
sudo -u dmitry sudo visudo
```

### –¢–µ—Å—Ç 4: NOPASSWD —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª—å)
```bash
# –§–ª–∞–≥ -n = non-interactive (–Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å)
sudo -u alex sudo -n ip addr show
sudo -u anna sudo -n journalctl -n 10
sudo -u dmitry sudo -n systemctl status

# –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–∫–∏ ‚Äî NOPASSWD –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –º–æ–∂–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å sudo –ø—Ä–∞–≤–∞ –¥–ª—è –ê–ª–µ–∫—Å–∞
sudo -u alex sudo -l

# –í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç:
# User alex may run the following commands on hostname:
#     (root) NOPASSWD: /usr/sbin/ip, /usr/bin/ss, ...
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ sudo –ø—Ä–∞–≤–∏–ª–∞
```bash
# –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ /etc/sudoers –∏ /etc/sudoers.d/*
sudo cat /etc/sudoers
sudo cat /etc/sudoers.d/*
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ sudo (–∫—Ç–æ —á—Ç–æ –¥–µ–ª–∞–ª)
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ sudo –∫–æ–º–∞–Ω–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è
sudo grep "sudo.*COMMAND" /var/log/auth.log | grep "$(date +%b\ %d)"

# –ö–æ–º–∞–Ω–¥—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo grep "alex.*COMMAND" /var/log/auth.log

# –ß–µ—Ä–µ–∑ journalctl
sudo journalctl _COMM=sudo --since today
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–Ω—Ü–∏–ø—ã, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —ç—Ç–∏—Ö –∫–æ–Ω—Ñ–∏–≥–∞—Ö:

**1. Principle of Least Privilege (–ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π)**
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç **—Ç–æ–ª—å–∫–æ** —Ç–µ –ø—Ä–∞–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
- –ê–ª–µ–∫—Å: –¢–û–õ–¨–ö–û —Å–µ—Ç–µ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –ê–Ω–Ω–∞: –¢–û–õ–¨–ö–û —á—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤
- –î–º–∏—Ç—Ä–∏–π: –¢–û–õ–¨–ö–û —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**2. Defense in Depth (–≠—à–µ–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞)**
- –Ø–≤–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (`!command`)
- –î–∞–∂–µ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ ‚Äî –æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

**3. Separation of Duties (–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π)**
- –ù–∏–∫—Ç–æ –Ω–µ –∏–º–µ–µ—Ç –ø–æ–ª–Ω–æ–≥–æ sudo
- –ê–ª–µ–∫—Å –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –î–º–∏—Ç—Ä–∏–π –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ê–Ω–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ, —á—Ç–æ —Ä–∞—Å—Å–ª–µ–¥—É–µ—Ç

**4. Audit Trail (–°–ª–µ–¥—ã –∞—É–¥–∏—Ç–∞)**
- –í—Å–µ sudo –∫–æ–º–∞–Ω–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `/var/log/auth.log`
- –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ç–æ, –∫–æ–≥–¥–∞, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª

**5. NOPASSWD —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é**
- NOPASSWD —É–¥–æ–±–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- –ù–û: –µ—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω ‚Äî –∞—Ç–∞–∫—É—é—â–∏–π –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ –∂–µ –ø—Ä–∞–≤–∞
- –ü–æ—ç—Ç–æ–º—É: —Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥!

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 1: –ó–∞–±—ã–ª –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
```bash
# ‚ùå –ü–õ–û–•–û: —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî sudo –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
sudo cp alex /etc/sudoers.d/alex

# ‚úÖ –•–û–†–û–®–û: –ø—Ä–æ–≤–µ—Ä–∏–ª —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ü–ï–†–ï–î –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
sudo visudo -c -f /etc/sudoers.d/alex
```

### –û—à–∏–±–∫–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```bash
# ‚ùå –ü–õ–û–•–û: —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
chmod 644 /etc/sudoers.d/alex
# sudo –æ—Ç–∫–∞–∂–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª!

# ‚úÖ –•–û–†–û–®–û: —Ç–æ–ª—å–∫–æ root –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å
sudo chmod 440 /etc/sudoers.d/alex
```

### –û—à–∏–±–∫–∞ 3: –ó–∞–±—ã–ª –ø—Ä–æ includedir
```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤ /etc/sudoers –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞:
grep "^#includedir /etc/sudoers.d" /etc/sudoers

# –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Ñ–∞–π–ª—ã –≤ /etc/sudoers.d/ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è!
```

### –û—à–∏–±–∫–∞ 4: –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–µ –º–∞—Å–∫–∏
```bash
# ‚ùå –û–ü–ê–°–ù–û: alex –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –í–°–Å –≤ /usr/sbin/
alex ALL=(root) NOPASSWD: /usr/sbin/*

# ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û: —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
alex ALL=(root) NOPASSWD: /usr/sbin/ip, /usr/sbin/iptables
```

---

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Sorry, user alex is not allowed..."
**–ü—Ä–∏—á–∏–Ω—ã:**
1. –§–∞–π–ª –Ω–µ –≤ `/etc/sudoers.d/`
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ (–Ω–µ 440)
3. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ —Ñ–∞–π–ª–µ
4. `includedir` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `/etc/sudoers`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –Ω–∞ –º–µ—Å—Ç–µ
ls -la /etc/sudoers.d/alex

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
stat /etc/sudoers.d/alex
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Access: (0440/-r--r-----)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
sudo visudo -c -f /etc/sudoers.d/alex

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å includedir
grep includedir /etc/sudoers
```

### –ü—Ä–æ–±–ª–µ–º–∞: sudo –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª—å (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç NOPASSWD)
**–ü—Ä–∏—á–∏–Ω—ã:**
1. –í `/etc/sudoers` –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ
2. –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∞–≤–∏–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–∞–≤–∏–ª–æ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç)

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo -u alex sudo -l

# –ï—Å–ª–∏ –≤–∏–¥–∏—à—å "(ALL) NOPASSWD: ALL" –∏ –Ω–∏–∂–µ "(root) /usr/sbin/ip"
# –ó–Ω–∞—á–∏—Ç –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –≤—Ç–æ—Ä–æ–µ

# –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:
# 1. /etc/sudoers
# 2. /etc/sudoers.d/* (–≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è sudoers —Ñ–∞–π–ª–∞ sudo –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å
**–ü–ê–ù–ò–ö–ê MODE!**

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞—è root —Å–µ—Å—Å–∏—è:
```bash
# –í root —Å–µ—Å—Å–∏–∏ ‚Äî –∏—Å–ø—Ä–∞–≤—å —Ñ–∞–π–ª
visudo -f /etc/sudoers.d/alex

# –ò–ª–∏ —É–¥–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —Ñ–∞–π–ª
rm /etc/sudoers.d/alex
```

–ï—Å–ª–∏ –Ω–µ—Ç root —Å–µ—Å—Å–∏–∏ ‚Äî –ø—Ä–∏–¥—ë—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å recovery mode:
1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ recovery mode (GRUB –º–µ–Ω—é)
2. –í—ã–±—Ä–∞—Ç—å "Drop to root shell"
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `/etc/sudoers` –∏–ª–∏ `/etc/sudoers.d/*`

**–ü–æ—ç—Ç–æ–º—É:** –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —á–µ—Ä–µ–∑ `visudo -c` –î–û –∞–∫—Ç–∏–≤–∞—Ü–∏–∏!

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### Man pages
```bash
man sudoers       # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç—É sudoers
man sudo          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–æ–º–∞–Ω–¥–µ sudo
man visudo        # –†–µ–¥–∞–∫—Ç–æ—Ä sudoers —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
```

### Online
- [Sudo Official Documentation](https://www.sudo.ws/docs/man/sudoers.man/)
- [Arch Wiki: sudo](https://wiki.archlinux.org/title/Sudo)
- [Red Hat: Configuring sudo](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-sudo-access_configuring-basic-system-settings)

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —ç—Ç–æ–≥–æ –∫—É—Ä—Å–∞
- Episode 04: Package Management (–ø—Ä–∏–Ω—Ü–∏–ø "–∏—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã")
- Episode 10: Processes & Systemd (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏)

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **2025-10-11:** –°–æ–∑–¥–∞–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ KERNEL SHADOWS
  - alex: –°–µ—Ç–µ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
  - anna: Read-only –ª–æ–≥–∏ (forensics)
  - dmitry: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (DevOps)
  - –ú–µ–Ω—Ç–æ—Ä: –ê–Ω–¥—Ä–µ–π –í–æ–ª–∫–æ–≤, –õ–≠–¢–ò
  - –õ–æ–∫–∞—Ü–∏—è: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –±–µ–ª—ã–µ –Ω–æ—á–∏

---

<div align="center">

**"Root ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è. –≠—Ç–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å."**

‚Äî –ê–Ω–¥—Ä–µ–π –í–æ–ª–∫–æ–≤, –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä, –õ–≠–¢–ò

</div>
