# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ä–µ—Å—É—Ä—Å–æ–≤
## Episode 09: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

> *"Resource limits ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫ –∏–∑–Ω—É—Ç—Ä–∏. –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å—ä–µ—Å—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Å–∏—Å—Ç–µ–º—ã."*
> ‚Äî –ê–Ω–¥—Ä–µ–π –í–æ–ª–∫–æ–≤, –õ–≠–¢–ò

---

## üìÅ –§–∞–π–ª—ã –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ

### `limits.conf` ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

–§–∞–π–ª `/etc/security/limits.conf` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–∏–º–∏—Ç—ã –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø.

**–ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã:**

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | nproc (–ø—Ä–æ—Ü–µ—Å—Å—ã) | nofile (—Ñ–∞–π–ª—ã) | core dumps |
|--------------|------------------|----------------|------------|
| **–í—Å–µ (*)**  | 2048 / 4096      | 4096 / 65536   | 0 (–≤—ã–∫–ª)   |
| **alex**     | 1500 / 3000      | 16384 / 65536  | 0          |
| **anna**     | 500 / 1000       | 4096 / 16384   | 0          |
| **dmitry**   | 2000 / 4000      | 16384 / 65536  | unlimited  |
| **viktor**   | 1500 / 3000      | 8192 / 65536   | 0          |

*–§–æ—Ä–º–∞—Ç: soft / hard*

---

## üí° –ó–∞—á–µ–º –Ω—É–∂–Ω—ã limits?

### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫ –∏–∑–Ω—É—Ç—Ä–∏

**–ë–µ–∑ –ª–∏–º–∏—Ç–æ–≤:**
```bash
# Fork bomb ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
:(){ :|:& };:
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–Ω–µ—Ç (–º–∏–ª–ª–∏–æ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
```

**–° –ª–∏–º–∏—Ç–∞–º–∏:**
```bash
ulimit -u 100  # –ú–∞–∫—Å–∏–º—É–º 100 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
:(){ :|:& };:
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ 100 –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### 2. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã

–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç "—Å—ä–µ—Å—Ç—å" –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã:
- –ü—Ä–æ—Ü–µ—Å—Å—ã (nproc)
- –û—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã (nofile)
- CPU –≤—Ä–µ–º—è
- –ü–∞–º—è—Ç—å

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**Core dumps** —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞:
- –ü–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- SSH –∫–ª—é—á–∏
- –¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
- Sensitive data

**–†–µ—à–µ–Ω–∏–µ:** –æ—Ç–∫–ª—é—á–∏—Ç—å core dumps (`core 0`)

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞
```bash
# –ë—ç–∫–∞–ø –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
sudo cp /etc/security/limits.conf /etc/security/limits.conf.backup

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
sudo cp limits.conf /etc/security/limits.conf

# –ü—Ä–∞–≤–∞ 644 (read-only –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
sudo chmod 644 /etc/security/limits.conf
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ PAM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PAM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pam_limits.so
grep pam_limits.so /etc/pam.d/common-session

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
# session required pam_limits.so
```

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤–∏—Ç—å:
```bash
echo "session required pam_limits.so" | sudo tee -a /etc/pam.d/common-session
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –õ–∏–º–∏—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ **–ù–û–í–û–ú –≤—Ö–æ–¥–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Å—Å–∏–∏ –ù–ï –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã.

```bash
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω:
logout
# –ò–ª–∏:
exit

# –ò –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ:
ssh user@server
# –ò–ª–∏:
sudo -i -u username
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ —Ç–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã
```bash
ulimit -a
```

–í—ã–≤–æ–¥:
```
core file size          (blocks, -c) 0           # core dumps –≤—ã–∫–ª—é—á–µ–Ω—ã
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 15594
max locked memory       (kbytes, -l) 65536
max memory size         (kbytes, -m) unlimited
open files                      (-n) 4096        # nofile (soft)
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 2048        # nproc (soft)
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã
```bash
# Soft nproc limit (–ø—Ä–æ—Ü–µ—Å—Å—ã)
ulimit -u

# Hard nproc limit
ulimit -H -u

# Soft nofile limit (—Ñ–∞–π–ª—ã)
ulimit -n

# Hard nofile limit
ulimit -H -n

# Core dump size
ulimit -c    # 0 = –≤—ã–∫–ª—é—á–µ–Ω–æ
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
# –í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
sudo -i -u alex

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏–º–∏—Ç—ã
ulimit -a

# –û–∂–∏–¥–∞–µ–º:
# open files (-n): 16384
# max user processes (-u): 1500
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏–º–∏—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
```bash
# –ù–∞–π—Ç–∏ PID –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep nginx

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏–º–∏—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞
cat /proc/<PID>/limits
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ê–ª–µ–∫—Å (—Å–µ—Ç–µ–≤–æ–π –∞–¥–º–∏–Ω):**
```bash
sudo -i -u alex
ulimit -n    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 16384
ulimit -u    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 1500
```

**–ê–Ω–Ω–∞ (forensics):**
```bash
sudo -i -u anna
ulimit -n    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 4096
ulimit -u    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 500 (–º–µ–Ω—å—à–µ ‚Äî –º–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω—É–∂–Ω–æ)
```

**–î–º–∏—Ç—Ä–∏–π (DevOps):**
```bash
sudo -i -u dmitry
ulimit -n    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 16384
ulimit -u    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 2000 (–±–æ–ª—å—à–µ ‚Äî Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã)
```

### –¢–µ—Å—Ç 2: –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**‚ö†Ô∏è –í—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ!**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∏–∑–∫–∏–π –ª–∏–º–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∞
ulimit -u 50

# –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
for i in {1..100}; do
  sleep 100 &
done

# –û–∂–∏–¥–∞–µ—Ç—Å—è: –æ—à–∏–±–∫–∞ –ø–æ—Å–ª–µ ~50 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
# bash: fork: retry: Resource temporarily unavailable
```

### –¢–µ—Å—Ç 3: –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ —Ñ–∞–π–ª–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∏–∑–∫–∏–π –ª–∏–º–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∞
ulimit -n 100

# –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤
for i in {1..200}; do
  exec 3<> /tmp/testfile_$i
done

# –û–∂–∏–¥–∞–µ—Ç—Å—è: –æ—à–∏–±–∫–∞ –ø–æ—Å–ª–µ ~100 —Ñ–∞–π–ª–æ–≤
# bash: /tmp/testfile_101: Too many open files
```

### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ core dumps –æ—Ç–∫–ª—é—á–µ–Ω—ã

```bash
ulimit -c    # –û–∂–∏–¥–∞–µ—Ç—Å—è: 0

# –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å core dump
sleep 10 &
kill -SIGSEGV $!

# Core dump –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è
ls -la core*   # –ù–µ—Ç —Ñ–∞–π–ª–∞ core
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –≤ runtime

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å soft limit (–¥–æ hard limit)
ulimit -n 10000    # nofile
ulimit -u 3000     # nproc

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
ulimit -n
ulimit -u
```

**‚ö†Ô∏è –ù–ï –ú–û–ñ–ï–®–¨ –ø—Ä–µ–≤—ã—Å–∏—Ç—å hard limit –±–µ–∑ root!**

```bash
# –ï—Å–ª–∏ hard limit = 65536:
ulimit -n 100000   # –û—à–∏–±–∫–∞!
# bash: ulimit: open files: cannot modify limit: Operation not permitted
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞–∫ root

```bash
# Root –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å hard limit
sudo bash

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π hard limit
ulimit -H -n 100000

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å soft limit
ulimit -n 100000

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
ulimit -H -n
ulimit -n
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Too many open files"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
nginx: [emerg] socket() failed (24: Too many open files)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –õ–∏–º–∏—Ç nofile —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ª–∏–º–∏—Ç
ulimit -n

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, www-data)
sudo -u www-data bash -c 'ulimit -n'

# –£–≤–µ–ª–∏—á–∏—Ç—å –≤ limits.conf:
www-data soft nofile 65536
www-data hard nofile 65536

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot fork: Resource temporarily unavailable"

**–°–∏–º–ø—Ç–æ–º—ã:**
```bash
bash: fork: retry: Resource temporarily unavailable
```

**–ü—Ä–∏—á–∏–Ω–∞:** –õ–∏–º–∏—Ç nproc –∏—Å—á–µ—Ä–ø–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
ps -u username | wc -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç
ulimit -u

# –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ–ª—å—à–µ —á–µ–º –ª–∏–º–∏—Ç ‚Äî —É–±–∏—Ç—å –ª–∏—à–Ω–∏–µ:
pkill -u username process_name

# –ò–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –≤ limits.conf
```

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–∏–º–∏—Ç—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ —Å–¥–µ–ª–∞–Ω logout/login
2. PAM –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–Ω–µ—Ç pam_limits.so)
3. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ limits.conf

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PAM
grep pam_limits.so /etc/pam.d/common-session

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å limits.conf
# (–Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã, –Ω–æ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ–π—Ç–∏)
sudo -i -u username
ulimit -a

# 3. –ï—Å–ª–∏ –ª–∏–º–∏—Ç—ã —Å—Ç–∞—Ä—ã–µ ‚Äî –Ω—É–∂–µ–Ω logout/login
# –ù–ï –ø–æ–º–æ–≥–∞–µ—Ç `ulimit` –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏!
exit
ssh username@server
ulimit -a  # –¢–µ–ø–µ—Ä—å –Ω–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –ª–∏–º–∏—Ç–æ–≤

**–î–ª—è systemd —Å–µ—Ä–≤–∏—Å–æ–≤** –ª–∏–º–∏—Ç—ã –∏–∑ `limits.conf` –ù–ï –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è!

–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ `.service` —Ñ–∞–π–ª–µ:

```ini
[Service]
LimitNOFILE=65536
LimitNPROC=4096
```

–ü—Ä–∏–º–µ—Ä:
```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å systemd unit
sudo systemctl edit nginx

# –î–æ–±–∞–≤–∏—Ç—å:
[Service]
LimitNOFILE=65536

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl daemon-reload
sudo systemctl restart nginx
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ —é–∑–∞–±–µ–ª—å–Ω–æ—Å—Ç—å—é

**–°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–µ –ª–∏–º–∏—Ç—ã:**
- ‚ùå –õ–µ–≥–∏—Ç–∏–º–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ùå Production —Å–µ—Ä–≤–∏—Å—ã –ø–∞–¥–∞—é—Ç

**–°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ –ª–∏–º–∏—Ç—ã:**
- ‚ùå DoS –∞—Ç–∞–∫–∏ –∏–∑–Ω—É—Ç—Ä–∏ –≤–æ–∑–º–æ–∂–Ω—ã
- ‚ùå –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "—Å—ä–µ–¥–∞–µ—Ç" –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
- ‚ùå –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã –∏—Å—Ö–æ–¥—è –∏–∑ **—Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π**
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ –£–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

### Core dumps –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–†–∏—Å–∫–∏:**
```bash
# –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å –ø–∞—Ä–æ–ª–µ–º –≤ –ø–∞–º—è—Ç–∏
./app --password "SuperSecret123"

# –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–¥–∞–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è core dump
ls -la core

# –ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å –ø–∞—Ä–æ–ª—å –∏–∑ core dump!
strings core | grep -i password
# Output: SuperSecret123
```

**–ó–∞—â–∏—Ç–∞:**
- –û—Ç–∫–ª—é—á–∏—Ç—å core dumps –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`ulimit -c 0`)
- –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ ‚Äî –≤–∫–ª—é—á–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `coredumpctl` (systemd) —Å ACL –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

### Root –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ?

**–î–∞, root –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å unlimited –ª–∏–º–∏—Ç—ã:**
- –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –î–ª—è emergency —Ä–µ–∂–∏–º–∞
- –î–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–¥–∞—á

**–ù–û:**
- –ó–∞—â–∏—â–∞–π root –∞–∫–∫–∞—É–Ω—Ç (SSH –∫–ª—é—á–∏, 2FA, sudo only)
- –ï—Å–ª–∏ root —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω ‚Äî –ª–∏–º–∏—Ç—ã –Ω–µ —Å–ø–∞—Å—É—Ç
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ root (–∏—Å–ø–æ–ª—å–∑—É–π sudo + least privilege)

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### Man pages
```bash
man limits.conf     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç—É —Ñ–∞–π–ª–∞
man pam_limits      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ PAM –º–æ–¥—É–ª—é
man ulimit          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–æ–º–∞–Ω–¥–µ ulimit
man getrlimit       # –°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è/—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–∏–º–∏—Ç–æ–≤
```

### Online
- [Linux limits.conf man page](https://linux.die.net/man/5/limits.conf)
- [PAM limits module](https://linux.die.net/man/8/pam_limits)
- [Kernel resource limits](https://www.kernel.org/doc/Documentation/sysctl/kernel.txt)

### –°–≤—è–∑–∞–Ω–Ω—ã–µ episode
- Episode 10: Processes & Systemd (–ª–∏–º–∏—Ç—ã –¥–ª—è systemd —Å–µ—Ä–≤–∏—Å–æ–≤)
- Episode 12: Backup & Recovery (–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∏—Å–∫–∞)

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **2025-10-11:** –°–æ–∑–¥–∞–Ω—ã –ª–∏–º–∏—Ç—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ KERNEL SHADOWS
  - –ó–∞—â–∏—Ç–∞ –æ—Ç fork bomb –∏ DoS –∞—Ç–∞–∫ –∏–∑–Ω—É—Ç—Ä–∏
  - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥—ã
  - Core dumps –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - –ú–µ–Ω—Ç–æ—Ä: –ê–Ω–¥—Ä–µ–π –í–æ–ª–∫–æ–≤, –õ–≠–¢–ò
  - –õ–æ–∫–∞—Ü–∏—è: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –±–µ–ª—ã–µ –Ω–æ—á–∏

---

<div align="center">

**"Resource limits ‚Äî —ç—Ç–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥—ã, —ç—Ç–æ –∑–∞—â–∏—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏."**

‚Äî –ê–Ω–¥—Ä–µ–π –í–æ–ª–∫–æ–≤, –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä, –õ–≠–¢–ò

</div>

