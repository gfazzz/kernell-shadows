# KERNEL SHADOWS Operation
# Security Requirements & Permissions Policy
# Episode 09: Users & Permissions
# Approved by: Viktor Petrov, Andrei Volkov

================================================================================
1. PRINCIPLE OF LEAST PRIVILEGE
================================================================================

MANDATORY: Each user must have ONLY the minimum permissions necessary for their
role. No exceptions.

Quote (Andrei Volkov): "Root access как заряженный пистолет. Не давай его кому
попало."

================================================================================
2. USER REQUIREMENTS
================================================================================

All team members MUST have:
  - Individual user accounts (no shared accounts!)
  - Strong passwords (min 12 characters, changed on first login)
  - Home directories with 700 permissions
  - Bash shell (/bin/bash)
  - Password expiry: 90 days

Team Members:
  ✓ Viktor Petrov     (Coordinator)
  ✓ Alex Sokolov      (Security Expert, ex-FSB)
  ✓ Anna Kovaleva     (Forensics Analyst)
  ✓ Dmitry Orlov      (DevOps Engineer)
  ✓ Max Sokolov       (System Administrator - you!)

================================================================================
3. GROUP STRUCTURE
================================================================================

Primary Groups:
  - operations      : Viktor, Dmitry, Max
  - security        : Alex, Anna
  - forensics       : Anna
  - devops          : Dmitry, Max
  - netadmin        : Alex

Rationale: Group-based permissions for easier management and audit trail.

================================================================================
4. SUDO POLICY
================================================================================

CRITICAL: sudo is NOT a privilege, it's a TOOL. Use sparingly.

Approved sudo configurations:

1. Viktor Petrov:
   - Full sudo access (ALL commands)
   - Rationale: Operation coordinator, final authority
   - Risk: High, must be closely monitored

2. Alex Sokolov:
   - RESTRICTED sudo: Network commands ONLY
   - Commands: ip, ss, netstat, tcpdump, iptables, ufw, nmap
   - NOPASSWD: Yes (operational efficiency)
   - Rationale: Security expert needs network access, NOT user management
   - Risk: Medium, limited to network subsystem

3. Anna Kovaleva:
   - NO sudo access
   - Rationale: Forensics requires read-only access (via ACL)
   - Risk: Low

4. Dmitry Orlov:
   - FUTURE: systemd service management (Episode 10)
   - Commands: systemctl, journalctl
   - Risk: Medium, limited to service management

FORBIDDEN:
  ❌ sudo ALL=(ALL) NOPASSWD: ALL for anyone except Viktor
  ❌ sudo passwd root (changing root password)
  ❌ sudo visudo (modifying sudo config without authorization)
  ❌ sudo rm -rf / (obviously)

================================================================================
5. ACL REQUIREMENTS (Anna Kovaleva)
================================================================================

Anna requires READ-ONLY access to logs for forensics analysis.

Method: ACL (Access Control Lists), NOT group membership

Required Access:
  ✓ /var/log/auth.log    (authentication logs)
  ✓ /var/log/syslog      (system logs)
  ✓ /var/log/kern.log    (kernel logs)
  ✓ /var/log/apache2/*   (web server logs, if applicable)

Permissions: READ ONLY (r--), NO write, NO execute

Implementation:
  sudo setfacl -m u:anna:r /var/log/auth.log
  sudo setfacl -m u:anna:rx /var/log  # execute for directory access

Rationale:
  - Forensics needs historical data
  - MUST NOT be able to tamper with logs (integrity!)
  - Defense against insider threats

================================================================================
6. SHARED DIRECTORY
================================================================================

Path: /var/operations/shared

Purpose: Team collaboration, shared files

Permissions: 3770 (rwxrws--T)
  - Owner: viktor
  - Group: operations
  - Others: no access
  - Sticky Bit (1): Only file owner can delete their own files
  - SGID (2): New files inherit 'operations' group

Members with access: viktor, dmitry, max (operations group)

Rationale:
  - Sticky bit prevents accidental deletion of others' files
  - SGID ensures consistent group ownership
  - Others have no access (confidentiality)

================================================================================
7. SECURITY AUDIT REQUIREMENTS
================================================================================

MANDATORY audits:

1. SUID/SGID Files:
   - Scan: Weekly
   - Baseline: Establish immediately after system setup
   - Alert: Any new SUID/SGID files in /tmp, /home, /var
   - Action: Investigate immediately

2. User Accounts:
   - Review: Monthly
   - Check for:
     * UID 0 accounts (besides root)
     * Accounts without passwords
     * Locked accounts that should be deleted
     * Inactive accounts (>90 days no login)

3. sudo Usage:
   - Monitor: Real-time (via /var/log/auth.log)
   - Review: Daily
   - Alert on:
     * Failed sudo attempts
     * sudo to root shell (sudo -i, sudo su)
     * Unauthorized commands

4. Permission Changes:
   - Monitor: Real-time (via auditd)
   - Alert on:
     * Changes to /etc/passwd, /etc/shadow, /etc/group
     * Changes to /etc/sudoers, /etc/sudoers.d/*
     * chmod 777 or 666 on sensitive files

================================================================================
8. PASSWORD POLICY
================================================================================

MANDATORY for all users:

Complexity:
  - Minimum 12 characters
  - Mix of uppercase, lowercase, numbers, symbols
  - NO dictionary words
  - NO personal information (name, birthday, etc.)

Expiry:
  - Maximum age: 90 days
  - Warning: 14 days before expiry
  - Minimum age: 1 day (prevent rapid changes)

First Login:
  - ALL new users MUST change password on first login
  - Temporary passwords: TempPass123! (change immediately)

Implementation:
  sudo chage -M 90 -m 1 -W 14 username
  sudo chage -d 0 username  # force change on first login

Rationale: Krylov's attacks often exploit weak/default passwords

================================================================================
9. DEFENSE IN DEPTH
================================================================================

Multiple security layers (no single point of failure):

Layer 1: Permissions (chmod/chown)
  - Base level protection
  - Standard Unix permissions (UGO model)

Layer 2: Groups
  - Role-based organization
  - Group-based permissions

Layer 3: sudo
  - Controlled privilege escalation
  - Limited to specific commands

Layer 4: ACL
  - Granular access control
  - Fine-tuned permissions beyond UGO

Layer 5: Auditd
  - Activity monitoring
  - Forensics trail

Layer 6: Fail2ban (future)
  - Brute-force protection
  - Automatic IP blocking

================================================================================
10. COMPLIANCE & AUDIT TRAIL
================================================================================

All changes MUST be logged:

Logging:
  ✓ sudo commands → /var/log/auth.log
  ✓ User creation/deletion → /var/log/auth.log
  ✓ Permission changes → auditd (future: Episode 12)
  ✓ Failed login attempts → /var/log/auth.log

Retention:
  - Logs: 365 days minimum
  - Backup: Daily, offsite
  - Immutability: Consider write-once storage

Audit Report:
  - Frequency: After each major change
  - Recipients: Viktor (coordinator), Andrei (mentor)
  - Format: /var/operations/security_audit_ep09.txt

================================================================================
11. INCIDENT RESPONSE
================================================================================

In case of compromised account:

1. IMMEDIATE: Lock account
   sudo passwd -l compromised_user

2. INVESTIGATE: Check logs
   sudo last compromised_user
   sudo grep "compromised_user" /var/log/auth.log

3. CONTAIN: Remove from groups
   sudo gpasswd -d compromised_user groupname

4. ANALYZE: Forensics (Anna)
   Check for backdoors, modified files, cron jobs

5. RECOVER: Reset or delete account
   sudo userdel -r compromised_user (after backup)

6. REPORT: Document incident
   File report to Viktor and Andrei

================================================================================
12. ANDREI VOLKOV'S UNIX WISDOM
================================================================================

"В Unix существует три типа администраторов:

1. Те, кто дают chmod 777 на всё.
   (Результат: система взломана за 24 часа)

2. Те, кто никому ничего не дают.
   (Результат: никто не может работать)

3. Те, кто понимают Principle of Least Privilege.
   (Результат: security AND usability)

Будь третьим типом, Макс."

================================================================================
13. APPROVAL
================================================================================

This policy is approved for KERNEL SHADOWS operation.

Signed:
  Viktor Petrov      - Operation Coordinator
  Andrei Volkov      - Security Advisor, LETI
  Max Sokolov        - System Administrator (implementation)

Date: Day 17-18 / 60
Location: Saint Petersburg, Russia

================================================================================
END OF REQUIREMENTS
================================================================================

