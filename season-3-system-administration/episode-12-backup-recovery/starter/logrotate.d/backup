# Logrotate configuration for backup logs (STARTER)
# Episode 12: Backup & Recovery
# Liisa Kask â€” "Fill in TODOs. Test with: sudo logrotate -d /etc/logrotate.d/backup"

# Main backup log
/var/log/backup.log {
    # How often to rotate?
    # Options: daily, weekly, monthly
    # TODO: Choose frequency (hint: daily for active backup systems)
    

    # How many old logs to keep?
    # Example: rotate 30 = keep 30 days
    # TODO: Set retention (hint: 30 for compliance/forensics)
    rotate 

    # Compress old logs?
    # Saves disk space (uses gzip -9)
    # TODO: Enable compression (hint: compress)
    

    # Don't compress most recent rotated log?
    # Reason: Log might still be written to for a short time
    # TODO: Enable delay compress (hint: delaycompress)
    

    # Don't error if log file doesn't exist?
    # TODO: Enable missingok (hint: missingok)
    

    # Don't rotate if log is empty?
    # TODO: Enable notifempty (hint: notifempty)
    

    # Create new log with permissions after rotation
    # Format: create MODE OWNER GROUP
    # Example: create 640 root adm
    # 640 = rw-r----- (owner: rw, group: r, others: none)
    # TODO: Set permissions (hint: create 640 root adm)
    create 

    # Use date extension instead of numbers?
    # Example: backup.log-20251012 instead of backup.log.1
    # TODO: Enable dateext (hint: dateext)
    

    # Date format (if dateext enabled)
    # TODO: Set format (hint: dateformat -%Y%m%d)
    dateformat 

    # Run scripts only once for all logs
    sharedscripts

    # Post-rotation script
    postrotate
        # TODO: Send weekly summary email on Mondays
        # Hint: Check if day of week = 1 (Monday)
        # Hint: Use 'mail' command to send
        # if [ $(date +%u) -eq 1 ]; then
        #     ...
        # fi
        
        
    endscript
}

# Health check logs
/var/log/backup-health.log {
    # TODO: Configure similar to main log
    # Hint: daily, rotate 14 (2 weeks is enough for health checks)
    
    
    
    
    
    
    
    
    
}

# Offsite backup logs
/var/log/backup-offsite.log {
    # TODO: Configure similar to main log
    # Hint: daily, rotate 30 (same as main backup log)
    
    
    
    
    
    
    
    
    
}

# Liisa's Hints:
# - Test config: sudo logrotate -d /etc/logrotate.d/backup
# - Force rotation: sudo logrotate -f /etc/logrotate.d/backup
# - Check logs: ls -lh /var/log/backup.log*
# - Verify compressed: zcat /var/log/backup.log.2.gz
# - 30 days retention = compliance + forensics window
# - 640 permissions = security (no world-readable logs)

