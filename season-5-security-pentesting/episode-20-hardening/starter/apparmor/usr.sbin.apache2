# AppArmor profile for Apache2
# Author: KERNEL SHADOWS Episode 20
# Level: enforce

#include <tunables/global>

/usr/sbin/apache2 {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/apache2-common>

  capability dac_override,
  capability setgid,
  capability setuid,
  capability net_bind_service,

  # Binary execution
  /usr/sbin/apache2 mr,

  # Configurations
  /etc/apache2/** r,
  /etc/ssl/** r,

  # Logs
  /var/log/apache2/* w,

  # Web content (READ ONLY)
  /var/www/** r,

  # PHP execution (if needed)
  /usr/bin/php* rix,

  # Temporary files
  /tmp/** rw,
  /var/tmp/** rw,

  # Network
  network tcp,
  network udp,

  # DENY dangerous operations
  deny /etc/shadow r,
  deny /etc/gshadow r,
  deny /root/** rwx,
  deny /home/*/.ssh/** rwx,
}
