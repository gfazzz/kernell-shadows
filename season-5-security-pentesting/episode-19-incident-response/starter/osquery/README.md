# Osquery Configuration ‚Äî Episode 19

## üì¶ Osquery

**SQL-powered endpoint monitoring** –¥–ª—è threat hunting –∏ incident response.

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# Ubuntu
sudo apt update
sudo apt install osquery

# Configure
sudo cp osquery.conf /etc/osquery/osquery.conf

# Start
sudo systemctl enable osqueryd
sudo systemctl start osqueryd
```

---

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Interactive Mode

```bash
# Launch osqueryi
sudo osqueryi

# Run queries
osquery> SELECT * FROM processes WHERE name LIKE '%hidden%';
osquery> SELECT * FROM process_open_sockets WHERE remote_address = '185.220.101.47';
osquery> SELECT * FROM kernel_modules WHERE name = 'rootkit';
```

### Scheduled Queries

Queries –≤ `osquery.conf` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- `incident_response_processes` ‚Äî –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫
- `network_connections` ‚Äî –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω
- `kernel_modules` ‚Äî –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω

### View Logs

```bash
# Osquery logs
sudo journalctl -u osqueryd -f

# Results
sudo cat /var/log/osquery/osqueryd.results.log | jq
```

---

## üéØ –î–ª—è Episode 19

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ osquery –¥–ª—è:
- Threat hunting (–ø–æ–∏—Å–∫ backdoors)
- Process monitoring
- Network connection tracking
- Kernel module detection
- File integrity monitoring

**Example threat hunt:**
```sql
-- Find suspicious processes
SELECT pid, name, path, cmdline 
FROM processes 
WHERE path LIKE '/tmp/%' OR name LIKE '%.hidden%';

-- Find C2 connections
SELECT * FROM process_open_sockets 
WHERE remote_address IN ('185.220.101.47', '91.213.8.112');

-- Find rootkits
SELECT * FROM kernel_modules 
WHERE name NOT IN (SELECT name FROM kernel_integrity);
```
