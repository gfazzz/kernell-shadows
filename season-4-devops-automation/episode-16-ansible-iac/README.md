# EPISODE 16: ANSIBLE & INFRASTRUCTURE AS CODE ü§ñüá≥üá±üá©üá™

> **"Configuration management is not about managing servers. It's about managing chaos."**
> ‚Äî Klaus Schmidt, Ansible Architect

---

## üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏

**–î–µ–Ω—å:** 31-32 –∏–∑ 60 (**SEASON 4 FINALE!**)
**–õ–æ–∫–∞—Ü–∏—è:** üá≥üá± Amsterdam (Tempelhof datacenter) ‚Üí üá©üá™ Berlin (final review)
**–í—Ä–µ–º—è:** 5-6 —á–∞—Å–æ–≤
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ

**–ü—Ä–µ–¥—ã–¥—É—â–∏–π —ç–ø–∏–∑–æ–¥:** [Episode 15: CI/CD Pipelines](../episode-15-cicd-pipelines/README.md) (Berlin)
**–°–ª–µ–¥—É—é—â–∏–π —ç–ø–∏–∑–æ–¥:** Episode 17: Security Auditing (Season 5 premiere ‚Äî Z√ºrich, Switzerland üá®üá≠)

---

## üé¨ –°—é–∂–µ—Ç

### –ü–µ—Ä–µ—Ö–æ–¥ Episode 15 ‚Üí Episode 16

**Hans (–ø—Ä–æ—â–∞–Ω–∏–µ –≤ –ë–µ—Ä–ª–∏–Ω–µ, –¥–µ–Ω—å 30):**
> *"–ú–∞–∫—Å, –î–º–∏—Ç—Ä–∏–π ‚Äî CI/CD pipeline –≥–æ—Ç–æ–≤. Automatic deployments —Ä–∞–±–æ—Ç–∞—é—Ç. Rollback –ø—Ä–æ–≤–µ—Ä–µ–Ω. –¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥ Season 4: configuration management. Klaus Schmidt –≤ Amsterdam –∂–¥—ë—Ç. 50 —Å–µ—Ä–≤–µ—Ä–æ–≤, –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, –æ–¥–Ω–∞ –º–∏–Ω—É—Ç–∞. Ansible. Go."*

**–î–µ–Ω—å 31: Amsterdam, Tempelhof Datacenter**

**09:00 ‚Äî Amsterdam Airport Schiphol**

–ú–∞–∫—Å –∏ –î–º–∏—Ç—Ä–∏–π –ø—Ä–∏–ª–µ—Ç–∞—é—Ç –≤ –ê–º—Å—Ç–µ—Ä–¥–∞–º. –°–Ω–æ–≤–∞ –∑–Ω–∞–∫–æ–º–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞: –∫–∞–Ω–∞–ª—ã, –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã, Dutch pragmatism. –ù–æ –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ ‚Äî –Ω–µ Science Park, –∞ –ø—Ä–æ–º–∑–æ–Ω–∞ Tempelhof.

**10:00 ‚Äî Tempelhof Datacenter**

Klaus Schmidt –≤—Å—Ç—Ä–µ—á–∞–µ—Ç —É –≤—Ö–æ–¥–∞ datacenter. –í—ã—Å–æ–∫–∏–π, 50+, —Å–µ–¥–∞—è –±–æ—Ä–æ–¥–∞, —Å—É—Ä–æ–≤—ã–π –≤–∑–≥–ª—è–¥ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–µ–ª –≤—Å—ë.

**Klaus:**
> *"–ú–∞–∫—Å, –î–º–∏—Ç—Ä–∏–π. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Tempelhof. 4000 —Å–µ—Ä–≤–µ—Ä–æ–≤. 200 –∫–æ–º–ø–∞–Ω–∏–π. –ó–¥–µ—Å—å –∂–∏–≤—ë—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –ò–¥—ë–º."*

(Klaus –ø—Ä–æ–≤–æ–¥–∏—Ç —á–µ—Ä–µ–∑ security, –º–∏–º–æ —Ä—è–¥–æ–≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å—Ç–æ–µ–∫. –®—É–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤, —Ö–æ–ª–æ–¥ –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–æ–≤, –º–∏–≥–∞–Ω–∏–µ LED –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)

**Klaus (—É —Ç–µ—Ä–º–∏–Ω–∞–ª–∞):**
> *"–í–∞—à–∏ 50 —Å–µ—Ä–≤–µ—Ä–æ–≤. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Ä—É—á–Ω—É—é? –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏?"*

**–î–º–∏—Ç—Ä–∏–π:**
> *"–û–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä ‚Äî 30 –º–∏–Ω—É—Ç. 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚Äî 25 —á–∞—Å–æ–≤. –ü–ª—é—Å –æ—à–∏–±–∫–∏, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è..."*

**Klaus:**
> *"–ò–º–µ–Ω–Ω–æ. –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è. –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫: 1 –∏–∑ 10. –û–¥–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ ‚Üí production down. –í–æ—Ç –ø–æ—á–µ–º—É —É –Ω–∞—Å Ansible. –°–º–æ—Ç—Ä–∏."*

(Klaus –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç terminal, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —Ñ–∞–π–ª: `playbook.yml`)

**Klaus:**
> *"–≠—Ç–æ—Ç —Ñ–∞–π–ª: 100 —Å—Ç—Ä–æ–∫ YAML. –û–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–∞–∫–µ—Ç—ã, —Å–µ—Ä–≤–∏—Å—ã, —Ñ–∞–π—Ä–≤–æ–ª–ª—ã, –≤—Å—ë. –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:"*

```bash
ansible-playbook -i inventory.ini playbook.yml
```

(–ù–∞–∂–∏–º–∞–µ—Ç Enter. –ù–∞ —ç–∫—Ä–∞–Ω–µ ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å:)

```
PLAY [Configure operation-shadow servers] **********************

TASK [Update packages] *****************************************
ok: [server-01]
ok: [server-02]
...
ok: [server-50]

TASK [Install Docker] ******************************************
changed: [server-01]
changed: [server-02]
...

PLAY RECAP *****************************************************
server-01    : ok=15  changed=8   unreachable=0   failed=0
server-02    : ok=15  changed=8   unreachable=0   failed=0
...
server-50    : ok=15  changed=8   unreachable=0   failed=0
```

**Klaus:**
> *"–ì–æ—Ç–æ–≤–æ. 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. 3 –º–∏–Ω—É—Ç—ã. –ò–¥–µ–Ω—Ç–∏—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è. –ù–æ–ª—å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫. –≠—Ç–æ Infrastructure as Code. –≠—Ç–æ Ansible."*

**Max (impressed):**
> *"–¢—Ä–∏ –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 25 —á–∞—Å–æ–≤?!"*

**Klaus:**
> *"Ja. –ê –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é? –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å YAML, –∑–∞–ø—É—Å–∫–∞–µ—à—å —Å–Ω–æ–≤–∞. Ansible –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω ‚Äî –º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å 100 —Ä–∞–∑, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–æ—Ç –∂–µ. –ù–∏–∫–∞–∫–∏—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –Ω–∏–∫–∞–∫–æ–π –∫–æ—Ä—Ä—É–ø—Ü–∏–∏. –≠—Ç–æ —Ñ–∏–Ω–∞–ª DevOps."*

### 11:00 ‚Äî Ansible Deep Dive

**Klaus's workshop:** Whiteboard, projector, terminal. Ansible architecture diagram –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω –º–µ–ª–æ–º.

**Klaus:**
> *"–§–∏–ª–æ—Å–æ—Ñ–∏—è Ansible:
> 1. **Agentless** ‚Äî –Ω–∏–∫–∞–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö, —Ç–æ–ª—å–∫–æ SSH
> 2. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –∑–∞–ø—É—Å—Ç–∏ 100 —Ä–∞–∑ = —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
> 3. **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—à—å –ß–¢–û, –∞ –Ω–µ –ö–ê–ö
> 4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî YAML, —á–∏—Ç–∞–µ–º—ã–π —á–µ–ª–æ–≤–µ–∫–æ–º
> 5. **–ú–æ—â—å** ‚Äî 3000+ –º–æ–¥—É–ª–µ–π
>
> –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
> - **Inventory** ‚Äî —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ (–≥—Ä—É–ø–ø—ã, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
> - **Playbook** ‚Äî YAML —Ñ–∞–π–ª —Å –∑–∞–¥–∞—á–∞–º–∏
> - **–ú–æ–¥—É–ª–∏** ‚Äî apt, copy, service, user, –∏ —Ç.–¥.
> - **–†–æ–ª–∏** ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
> - **–®–∞–±–ª–æ–Ω—ã** ‚Äî Jinja2 –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤
> - **Handlers** ‚Äî –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞)
> - **Vault** ‚Äî –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
>
> –°–µ–≥–æ–¥–Ω—è –≤—ã –∏–∑—É—á–∏—Ç–µ –≤—Å—ë —ç—Ç–æ. –ö –∫–æ–Ω—Ü—É –¥–Ω—è –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å–∞–º–∏. –û–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π."*

(Klaus –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã)

### 14:00 ‚Äî Practice Session

Max –∏ Dmitry —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ Ansible playbooks. Klaus –Ω–∞–±–ª—é–¥–∞–µ—Ç, –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—é—Ç:
- Inventory —Ñ–∞–π–ª (50 servers –≤ –≥—Ä—É–ø–ø–∞—Ö: web, database, cache)
- –ë–∞–∑–æ–≤—ã–π playbook (users, packages, firewall)
- –†–æ–ª–∏ (webserver, database, monitoring)
- Templates –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ (nginx, PostgreSQL)
- Handlers –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤

–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç. –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç. 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è –∑–∞ 3-4 –º–∏–Ω—É—Ç—ã.

**Klaus:**
> *"–•–æ—Ä–æ—à–æ. Configuration management –æ—Å–≤–æ–µ–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –¥–æ 500 —Å–µ—Ä–≤–µ—Ä–æ–≤. –ò–ª–∏ 5000. –¢–æ—Ç –∂–µ playbook."*

### TWIST (–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–∫–æ–ª–æ 16:30, –¥–µ–Ω—å 31)

**16:00 ‚Äî Normal operations**

Max –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π playbook. –í—Å—ë –∏–¥—ë—Ç —É—Å–ø–µ—à–Ω–æ. Tasks –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, servers –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è.

**16:30 ‚Äî –ù–ï–û–ñ–ò–î–ê–ù–ù–û–ï –û–¢–ö–†–´–¢–ò–ï**

**Ansible –≤—ã–≤–æ–¥ (server-27):**

```
TASK [Copy SSL certificates] ***********************************
changed: [server-27]

TASK [Verify certificate validity] *****************************
FAILED: [server-27]
  Certificate expired: 2024-11-15
  Certificate CN: operation-shadow.net
  Issued by: Let's Encrypt
```

**–ú–∞–∫—Å:**
> *"Klaus, server-27 ‚Äî SSL certificate –ø—Ä–æ—Å—Ä–æ—á–µ–Ω?"*

**Klaus (–ø–æ–¥—Ö–æ–¥–∏—Ç –∫ —ç–∫—Ä–∞–Ω—É):**
> *"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω 3 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥. –ù–æ —Å–µ—Ä–≤–µ—Ä –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç. –ó–Ω–∞—á–∏—Ç... –∫—Ç–æ-—Ç–æ –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏–ª. –ù–æ –Ω–µ –æ–±–Ω–æ–≤–∏–ª Ansible playbook. –†—É—á–Ω–æ–π –¥—Ä–∏—Ñ—Ç."*

(Klaus –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç server-27 –≤ –±—Ä–∞—É–∑–µ—Ä–µ)

**Klaus:**
> *"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω –¥–æ 2026. –û–±–Ω–æ–≤–ª—ë–Ω –≤—Ä—É—á–Ω—É—é. –ö—Ç–æ —ç—Ç–æ —Å–¥–µ–ª–∞–ª?"*

(–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏ server-27)

```bash
ansible server-27 -m shell -a "last | grep root"
```

**Output:**
```
root   pts/0   185.220.101.52   Nov 20 03:42 - 03:55  (00:13)
```

**Klaus (–Ω–∞–ø—Ä—è–≥–∞–µ—Ç—Å—è):**
> *"185.220.101.52... –≠—Ç–æ—Ç IP –∑–Ω–∞–∫–æ–º—ã–π?"*

**Max (–≤–Ω–µ–∑–∞–ø–Ω–æ):**
> *"–≠—Ç–æ Tor exit node! Anna –Ω–∞—Ö–æ–¥–∏–ª–∞ —ç—Ç–æ—Ç IP –≤ Episode 14 ‚Äî backdoor –æ—Ç Krylov!"*

**Klaus:**
> *"Scheisse. Krylov –∏–º–µ–ª root access –Ω–∞ server-27 —Ç—Ä–∏ –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥. –ü–æ–º–µ–Ω—è–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. –ú—ã –Ω–µ –∑–Ω–∞–µ–º —á—Ç–æ –µ—â—ë –æ–Ω –∏–∑–º–µ–Ω–∏–ª. –í–æ—Ç –ø–æ—á–µ–º—É Infrastructure as Code –∫—Ä–∏—Ç–∏—á–µ–Ω ‚Äî –ª—é–±–æ–µ —Ä—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ –∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥."*

**–î–º–∏—Ç—Ä–∏–π:**
> *"–ß—Ç–æ –æ–Ω –º–æ–≥ —Å–¥–µ–ª–∞—Ç—å –∑–∞ 13 –º–∏–Ω—É—Ç root access?"*

**Klaus:**
> *"Backdoor. Keylogger. –£—Ç–µ—á–∫—É –¥–∞–Ω–Ω—ã—Ö. –ß—Ç–æ —É–≥–æ–¥–Ω–æ. –ù—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π audit. –°–ï–ô–ß–ê–°."*

#### Emergency Audit (16:30 - 17:30)

**Tasks (under time pressure):**

**1. Full system audit —Å Ansible:**

```yaml
# audit.yml
- name: Security Audit - Server 27
  hosts: server-27
  tasks:
    - name: Check for unauthorized users
      shell: awk -F: '$3 >= 1000 {print $1}' /etc/passwd
      register: users

    - name: Check for suspicious cron jobs
      shell: crontab -l
      register: crontab

    - name: Check for unauthorized SSH keys
      shell: cat ~/.ssh/authorized_keys
      register: ssh_keys

    - name: Check for suspicious processes
      shell: ps aux | grep -v grep | grep -E "nc|ncat|socat|reverse"
      register: processes
      ignore_errors: yes

    - name: Check for modified system files
      shell: debsums -c
      register: file_integrity
      ignore_errors: yes

    - name: Generate audit report
      debug:
        msg: |
          Users: {{ users.stdout }}
          Crontab: {{ crontab.stdout }}
          SSH Keys: {{ ssh_keys.stdout }}
          Suspicious Processes: {{ processes.stdout }}
          Modified Files: {{ file_integrity.stdout }}
```

**2. Run audit:**

```bash
ansible-playbook -i inventory.ini audit.yml
```

**3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (17:00):**

```
TASK [Check for suspicious processes]
ok: [server-27]
  stdout: ""  ‚Üê No active backdoor processes

TASK [Check for modified system files]
changed: [server-27]
  stdout: "/usr/bin/openssl: checksum mismatch"  ‚Üê MODIFIED!
```

**Klaus:**
> *"OpenSSL binary –∏–∑–º–µ–Ω—ë–Ω! –≠—Ç–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è —Ä—É—Ç–∫–∏—Ç–æ–≤. –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä —Å –Ω—É–ª—è. Ansible –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –ª–µ–≥–∫–æ ‚Äî –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞."*

**4. Server rebuild (17:00 - 17:30):**

```bash
# 1. Isolate server
ansible server-27 -m shell -a "iptables -A INPUT -j DROP"

# 2. Backup data
ansible server-27 -m shell -a "tar -czf /backup/server-27-$(date +%Y%m%d).tar.gz /var/www"

# 3. Reinstall OS (manual ‚Äî datacenter KVM)
# Klaus connects to datacenter KVM, reinstalls Ubuntu

# 4. Reconfigure with Ansible
ansible-playbook -i inventory.ini playbook.yml --limit server-27

# 5. Restore data
ansible server-27 -m unarchive -a "src=/backup/server-27-20251031.tar.gz dest=/var/www"

# 6. Verify
ansible server-27 -m shell -a "debsums -c"  # All OK
```

**17:30 ‚Äî Resolution**

Server-27 –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –Ω—É–ª—è –∑–∞ 30 –º–∏–Ω—É—Ç (–≤–º–µ—Å—Ç–æ 8+ —á–∞—Å–æ–≤ —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è). Ansible playbook –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**Klaus:**
> *"–≠—Ç–æ –º–æ—â—å Infrastructure as Code. –°–µ—Ä–≤–µ—Ä —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω? –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∑–∞ 30 –º–∏–Ω—É—Ç. –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞? 8 —á–∞—Å–æ–≤ + –æ—à–∏–±–∫–∏. IaC = —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç —Ö–∞–æ—Å–∞."*

**–ú–∞–∫—Å:**
> *"–ù–æ –ö—Ä—ã–ª–æ–≤ –∏–º–µ–ª root 3 –Ω–µ–¥–µ–ª–∏. –ß—Ç–æ –µ—â—ë –æ–Ω –º–æ–≥ —Å–¥–µ–ª–∞—Ç—å?"*

**Klaus:**
> *"–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å–µ–π—á–∞—Å. Ansible –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –±—ã—Å—Ç—Ä–æ."*

(Klaus –∑–∞–ø—É—Å–∫–∞–µ—Ç full audit –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö ‚Äî 5 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 10 —á–∞—Å–æ–≤)

**Results (17:40):**
- **server-27:** Compromised, rebuilt ‚úì
- **servers 01-26, 28-50:** Clean ‚úì
- **Total audit time:** 5 minutes (Ansible) vs 10+ hours (manual)

**Klaus:**
> *"–í—Å—ë —á–∏—Å—Ç–æ –∫—Ä–æ–º–µ server-27. Krylov –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ. –ë–ª–∞–≥–æ–¥–∞—Ä—è Ansible –º—ã –Ω–∞—à–ª–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –±—ã—Å—Ç—Ä–æ. –†—É—á–Ω–æ–π audit? –í—ã –±—ã –≤—Å—ë –µ—â—ë –ø—Ä–æ–≤–µ—Ä—è–ª–∏ server 5."*

### –§–∏–Ω–∞–ª Episode 16 + Season 4

**18:00 ‚Äî Amsterdam Tempelhof, Debriefing**

**Klaus:**
> *"–°–µ–≥–æ–¥–Ω—è –≤—ã –∏–∑—É—á–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫—É—Å–æ—á–µ–∫ DevOps –ø–∞–∑–ª–∞:
>
> - **Episode 13 (Git):** Version control ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
> - **Episode 14 (Docker):** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è ‚Äî –ø–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
> - **Episode 15 (CI/CD):** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ‚Äî –±—ã—Å—Ç—Ä—ã–µ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—ã
> - **Episode 16 (Ansible):** Configuration management ‚Äî –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
>
> –í–º–µ—Å—Ç–µ = Infrastructure as Code. –í—Å—ë –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ. –ù–∏–∫–∞–∫–æ–π —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –ù–∏–∫–∞–∫–∏—Ö —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ—Å—å –æ—Ç 1 –¥–æ 1000 —Å–µ—Ä–≤–µ—Ä–æ–≤. –≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π DevOps."*

**–ú–∞–∫—Å:**
> *"–ß–µ—Ç—ã—Ä–µ —ç–ø–∏–∑–æ–¥–∞ –Ω–∞–∑–∞–¥ —è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª —Å–µ—Ä–≤–µ—Ä—ã –≤—Ä—É—á–Ω—É—é, 30 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π. –°–µ–π—á–∞—Å ‚Äî 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ –∑–∞ 3 –º–∏–Ω—É—Ç—ã."*

**Klaus:**
> *"–ò–º–µ–Ω–Ω–æ. –≠—Ç–æ 50√ó —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ù–æ –∑–∞–ø–æ–º–Ω–∏—Ç–µ —Å–µ–≥–æ–¥–Ω—è: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞—Ç–∞–∫—É—é—â–∏—Ö. Krylov –æ–±–æ—à—ë–ª –≤—Å—ë —Å root access. –§–æ–∫—É—Å Season 5: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –í—ã –µ–¥–µ—Ç–µ –≤ –®–≤–µ–π—Ü–∞—Ä–∏—é ‚Äî –¶—é—Ä–∏—Ö, Cyber Defense Center. –ò–∑—É—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ, security auditing, hardening. –ü–æ—Ç–æ–º—É —á—Ç–æ –±—ã—Å—Ç—Ä–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–∞, –µ—Å–ª–∏ –Ω–µ –∑–∞—â–∏—â–µ–Ω–∞."*

**19:00 ‚Äî Train to Berlin**

Max –∏ Dmitry –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –ë–µ—Ä–ª–∏–Ω –Ω–∞ –ø–æ–µ–∑–¥–µ. –û–±—Å—É–∂–¥–∞—é—Ç Season 4.

**–î–º–∏—Ç—Ä–∏–π:**
> *"–ó–∞ 8 –¥–Ω–µ–π –º—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç Git –¥–æ Ansible. –û—Ç —Ä—É—á–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫ Infrastructure as Code. –≠—Ç–æ –±—ã–ª –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π —Å–µ–∑–æ–Ω."*

**–ú–∞–∫—Å:**
> *"–ò –¥–≤–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞: —è —Å–ª–æ–º–∞–ª production –≤ Episode 15, –ö—Ä—ã–ª–æ–≤ –≤–∑–ª–æ–º–∞–ª server-27 –≤ Episode 16. –ö–∞–∂–¥—ã–π —Ä–∞–∑ –º—ã —É—á–∏–ª–∏—Å—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö."*

**–î–º–∏—Ç—Ä–∏–π:**
> *"–≠—Ç–æ DevOps –∫—É–ª—å—Ç—É—Ä–∞. Fail fast, learn fast, automate recovery. –¢–µ–ø–µ—Ä—å Season 5 ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –í–∏–∫—Ç–æ—Ä —É–∂–µ –∑–∞–∫–∞–∑–∞–ª –±–∏–ª–µ—Ç—ã –≤ –¶—é—Ä–∏—Ö."*

**20:00 ‚Äî Berlin, Chaos Computer Club**

–í—Å—Ç—Ä–µ—á–∞ —Å Hans –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ review Season 4.

**Hans:**
> *"Max, Dmitry. Season 4 –∑–∞–≤–µ—Ä—à—ë–Ω. –ß–µ—Ç—ã—Ä–µ —ç–ø–∏–∑–æ–¥–∞, —á–µ—Ç—ã—Ä–µ –Ω–∞–≤—ã–∫–∞:
> 1. Git ‚Äî –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ version control
> 2. Docker ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏
> 3. CI/CD ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è deployment
> 4. Ansible ‚Äî configuration management
>
> –í—ã —Ç–µ–ø–µ—Ä—å DevOps-–∏–Ω–∂–µ–Ω–µ—Ä—ã. –ù–µ junior. –ù–µ mid. Senior level. Infrastructure as Code —Ç–µ—á—ë—Ç –≤ –≤–∞—à–∏—Ö –≤–µ–Ω–∞—Ö. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é."*

**–ú–∞–∫—Å:**
> *"–°–ø–∞—Å–∏–±–æ, Hans. –ò Sophie, –∏ Klaus. –ó–∞ —ç—Ç–∏ 8 –¥–Ω–µ–π."*

**Hans:**
> *"–ù–æ –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –º–æ—â–Ω–∞—è. –ù–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ = –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞, –∫–æ—Ç–æ—Ä–∞—è –∂–¥—ë—Ç —Å–≤–æ–µ–≥–æ —á–∞—Å–∞. Krylov –ø–æ–∫–∞–∑–∞–ª —ç—Ç–æ. –í Season 5 –≤—ã –∏–∑—É—á–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –ü–æ—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å. –ù–∞–º –Ω—É–∂–Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±—ã—Å—Ç—Ä–∞—è. –ü–æ–Ω—è—Ç–Ω–æ?"*

**Max & Dmitry:**
> *"Understood."*

**Cliffhanger (Season 5 preview):**

**–í–∏–∫—Ç–æ—Ä (–≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫, 21:00):**
> *"–ú–∞–∫—Å, –î–º–∏—Ç—Ä–∏–π. Season 4 –∑–∞–≤–µ—Ä—à—ë–Ω. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –¢–µ–ø–µ—Ä—å –∑–∞—â–∏—â–∞–µ–º –µ—ë. –ó–∞–≤—Ç—Ä–∞ –≤—ã –ª–µ—Ç–∏—Ç–µ –≤ –¶—é—Ä–∏—Ö. –í—Å—Ç—Ä–µ—Ç–∏—Ç–µ—Å—å —Å Eva Zimmerman ‚Äî ex-NSA, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ. –û–Ω–∞ –Ω–∞—É—á–∏—Ç –≤–∞—Å –≤–∑–ª–∞–º—ã–≤–∞—Ç—å –≤–∞—à—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç –ö—Ä—ã–ª–æ–≤. –≠—Ç–æ Season 5: Security & Pentesting. 4 –Ω–µ–¥–µ–ª–∏. –ì–æ—Ç–æ–≤—å—Ç–µ—Å—å. ‚Äî –í–∏–∫—Ç–æ—Ä."*

(–≠–∫—Ä–∞–Ω –≥–∞—Å–Ω–µ—Ç. –¢–∏—Ç—Ä—ã Season 4.)

**TO BE CONTINUED IN SEASON 5...**

---


---

## üéØ –ú–∏—Å—Å–∏—è Episode 16 (SEASON 4 FINALE!)

**–û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 50 —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—è Ansible (Infrastructure as Code). –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, –º–∞—Å—Å–æ–≤–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, –∏–¥–µ–Ω—Ç–∏—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:**

1. ‚úÖ **Install Ansible** (control node setup)
2. ‚úÖ **Create inventory file** (50 servers, groups: web/db/cache)
3. ‚úÖ **Write basic playbook** (users, packages, firewall)
4. ‚úÖ **Use modules** (apt, copy, service, user, template)
5. ‚úÖ **Create roles** (webserver, database, monitoring ‚Äî reusable)
6. ‚úÖ **Use templates** (Jinja2 for nginx.conf, postgresql.conf)
7. ‚úÖ **Implement handlers** (restart services on config change)
8. ‚úÖ **Ansible Vault** (encrypt secrets: passwords, API keys)
9. ‚úÖ **TWIST: Certificate audit** ‚Äî Ansible finds expired cert, security review

**–§–∏–Ω–∞–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç:**
- Ansible playbooks –¥–ª—è 50 servers
- Roles (reusable configurations)
- Templates (dynamic configs)
- Encrypted secrets (Vault)
- **Season 4 –∑–∞–≤–µ—Ä—à—ë–Ω!** üéâ

---

## üéì –£—á–µ–±–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞: 7 —Ü–∏–∫–ª–æ–≤

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 5-6 —á–∞—Å–æ–≤
**–§–æ—Ä–º–∞—Ç:** Interleaving (–°—é–∂–µ—Ç ‚Üí –¢–µ–æ—Ä–∏—è ‚Üí –ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞)

1. **–¶–∏–∫–ª 1:** Ansible Basics ‚Äî –û—Ä–∫–µ—Å—Ç—Ä-–¥–∏—Ä–∏–∂—ë—Ä üéº (10-15 –º–∏–Ω)
2. **–¶–∏–∫–ª 2:** Inventory & Groups ‚Äî –ê–¥—Ä–µ—Å–Ω–∞—è –∫–Ω–∏–≥–∞ üìá (10-15 –º–∏–Ω)
3. **–¶–∏–∫–ª 3:** Playbooks & Modules ‚Äî –†–µ—Ü–µ–ø—Ç –ø–æ–≤–∞—Ä–∞ üë®‚Äçüç≥ (10-15 –º–∏–Ω)
4. **–¶–∏–∫–ª 4:** Roles ‚Äî Lego Blueprints üß± (10-15 –º–∏–Ω)
5. **–¶–∏–∫–ª 5:** TWIST ‚Äî Certificate Expired (Security Audit) üîç (15-20 –º–∏–Ω)
6. **–¶–∏–∫–ª 6:** Templates & Variables ‚Äî Mad Libs ‚úçÔ∏è (15-20 –º–∏–Ω)
7. **–¶–∏–∫–ª 7:** Vault & Secrets ‚Äî –°–µ–π—Ñ üîê (10-15 –º–∏–Ω)

---

## –¶–ò–ö–õ 1: Ansible Basics ‚Äî –û—Ä–∫–µ—Å—Ç—Ä-–¥–∏—Ä–∏–∂—ë—Ä üéº
### (10-15 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Klaus –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∞–≥–∏—é

**11:15 ‚Äî Klaus's workshop**

Klaus –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª. –û–¥–∏–Ω —Ñ–∞–π–ª: `playbook.yml`. –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:

```bash
ansible-playbook -i inventory.ini playbook.yml
```

50 —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞—á–∏–Ω–∞—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ª–µ—Ç–∏—Ç:

```
TASK [Install nginx] *******************
ok: [server-01]
ok: [server-02]
... (48 more)
ok: [server-50]

PLAY RECAP *****************************
server-50    : ok=12  changed=6   failed=0
Total time: 3m 14s
```

**Klaus:**
> *"3 –º–∏–Ω—É—Ç—ã. 50 —Å–µ—Ä–≤–µ—Ä–æ–≤. –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞. Ansible ‚Äî —ç—Ç–æ –¥–∏—Ä–∏–∂—ë—Ä –æ—Ä–∫–µ—Å—Ç—Ä–∞. –î–∏—Ä–∏–∂—ë—Ä –º–∞—à–µ—Ç –ø–∞–ª–æ—á–∫–æ–π, 50 –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤ –∏–≥—Ä–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ."*

**LILITH:**
> *"Ansible ‚Äî —ç—Ç–æ –¥–∏—Ä–∏–∂—ë—Ä –¥–ª—è servers. –û–¥–∏–Ω –¥–∏—Ä–∏–∂—ë—Ä, 50 –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤. –ë–µ–∑ –¥–∏—Ä–∏–∂—ë—Ä–∞ ‚Äî —Ö–∞–æ—Å. –° –¥–∏—Ä–∏–∂—ë—Ä–æ–º ‚Äî —Å–∏–º—Ñ–æ–Ω–∏—è. Configuration management at scale."*

---

### üìö –¢–µ–æ—Ä–∏—è: –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Ansible?

**–ü—Ä–æ–±–ª–µ–º—ã —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

‚ùå **Time consuming:** 1 server = 30 min. 50 servers = 25 hours
‚ùå **Error-prone:** Human mistakes (typos, –∑–∞–±—ã–ª –∫–æ–º–∞–Ω–¥—É)
‚ùå **Inconsistent:** Server 1 ‚â† Server 2 (—Ä–∞–∑–Ω—ã–µ configs)
‚ùå **Not scalable:** 50 servers —Å–µ–≥–æ–¥–Ω—è, 500 tomorrow?
‚ùå **No version control:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ tracked

**–° Ansible:**

‚úÖ **Fast:** 50 servers –∑–∞ 3-5 minutes
‚úÖ **Reliable:** Computers don't typo
‚úÖ **Consistent:** –í—Å–µ servers –∏–¥–µ–Ω—Ç–∏—á–Ω—ã
‚úÖ **Scalable:** 50 –∏–ª–∏ 5000 ‚Äî —Ç–∞ –∂–µ –∫–æ–º–∞–Ω–¥–∞
‚úÖ **Version controlled:** YAML –≤ Git

**LILITH:**
> *"Manual configuration ‚Äî —ç—Ç–æ –∫–∞–∫ –ø–µ—á–∞—Ç–∞—Ç—å –∫–Ω–∏–≥–∏ –≤—Ä—É—á–Ω—É—é. –ú–µ–¥–ª–µ–Ω–Ω–æ, –æ—à–∏–±–∫–∏. Ansible ‚Äî —ç—Ç–æ printing press. Fast, accurate, scalable."*

---

### üí° –ú–µ—Ç–∞—Ñ–æ—Ä–∞: Ansible = Orchestra Conductor

```
üéº Orchestra

Conductor (Ansible Control Node)
    ‚îÇ
    ‚îú‚îÄ‚Üí üéª Violin section (web servers)
    ‚îÇ       Play: nginx + SSL
    ‚îÇ
    ‚îú‚îÄ‚Üí üé∫ Brass section (database servers)
    ‚îÇ       Play: PostgreSQL + backups
    ‚îÇ
    ‚îú‚îÄ‚Üí ü•Å Percussion (cache servers)
    ‚îÇ       Play: Redis + monitoring
    ‚îÇ
    ‚îî‚îÄ‚Üí üéπ Piano (load balancers)
            Play: HAProxy + health checks

Conductor waves baton ‚Üí All play together
Ansible runs playbook ‚Üí All configure together
```

**Without conductor:**
- Each musician plays alone ‚Üí cacophony
- Each admin configures manually ‚Üí chaos

**With conductor:**
- Synchronized performance ‚Üí symphony
- Automated configuration ‚Üí harmony

**Klaus:**
> *"Conductor doesn't play instrument. Ansible doesn't run commands. Conductor coordinates. Ansible orchestrates."*

---

### üìñ Ansible Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Control Node (your laptop)               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Ansible installed                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Playbooks (YAML files)                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Inventory (list of servers)               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ SSH (agentless!)
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ           ‚îÇ           ‚îÇ
        ‚ñº           ‚ñº           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Server 1 ‚îÇ  ‚îÇ Server 2 ‚îÇ  ‚îÇ Server N ‚îÇ
‚îÇ (no agent)‚îÇ  ‚îÇ (no agent)‚îÇ  ‚îÇ (no agent)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Key concept: AGENTLESS**

- ‚ùå Puppet/Chef: Need agent installed on every server
- ‚úÖ Ansible: Only SSH required (servers already have it!)

**Why agentless?**
- ‚úÖ No installation/maintenance on servers
- ‚úÖ No agent updates
- ‚úÖ No "agent died" errors
- ‚úÖ Works on any Linux (SSH standard)

**LILITH:**
> *"Agentless ‚Äî —ç—Ç–æ –∫—Ä–∞—Å–∏–≤–æ. Puppet —Ç—Ä–µ–±—É–µ—Ç agent –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ. Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSH. SSH —É–∂–µ –≤–µ–∑–¥–µ. Don't reinvent the wheel."*

---

### üíª –ü—Ä–∞–∫—Ç–∏–∫–∞ 1: Install Ansible

```bash
# Control node (your laptop/jumpbox)
# Ubuntu/Debian:
sudo apt update
sudo apt install ansible -y

# Verify
ansible --version

# Create project directory
mkdir ~/ansible-operation-shadow
cd ~/ansible-operation-shadow

# Test connectivity to servers
ansible all -i "server1.example.com," -m ping
# Output: server1.example.com | SUCCESS => { "ping": "pong" }
```

**Klaus:**
> *"Installation done. Now you are conductor. Servers are your orchestra."*

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 1

**–í–æ–ø—Ä–æ—Å 1:** –ü–æ—á–µ–º—É Ansible –±—ã—Å—Ç—Ä–µ–µ —á–µ–º manual configuration?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Parallel execution.**

Manual (sequential):
```
Server 1 ‚Üí 30 min
Server 2 ‚Üí 30 min
...
Server 50 ‚Üí 30 min
Total: 50 √ó 30 = 1500 min (25 hours!)
```

Ansible (parallel):
```
All 50 servers AT ONCE ‚Üí 3-5 min
(limited by slowest server)
```

**Parallelism = speed.**

**Klaus:** *"Diri

–∂—ë—Ä –Ω–µ –∏–≥—Ä–∞–µ—Ç —Å –∫–∞–∂–¥—ã–º –º—É–∑—ã–∫–∞–Ω—Ç–æ–º –ø–æ –æ—á–µ—Ä–µ–¥–∏. –í—Å–µ –∏–≥—Ä–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. Ansible —Ç–æ –∂–µ —Å–∞–º–æ–µ."*

</details>

**–í–æ–ø—Ä–æ—Å 2:** –ß—Ç–æ –∑–Ω–∞—á–∏—Ç "agentless"?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **No software installation on managed servers.**

**With agent (Puppet/Chef):**
```bash
# On EVERY server:
curl -L install-puppet.sh | bash
puppet agent --enable
systemctl enable puppet-agent
# Repeat 50 times! üò±
```

**Ansible (agentless):**
```bash
# Servers: Nothing! SSH already there ‚úÖ
# Control node: ansible-playbook playbook.yml
```

**Requirements:**
- Servers: SSH enabled (default on Linux)
- Control node: Ansible installed

**LILITH:** *"Agent = extra complexity. Agentless = simplicity. KISS principle (Keep It Simple, Stupid)."*

</details>

---

## –¶–ò–ö–õ 2: Inventory & Groups ‚Äî –ê–¥—Ä–µ—Å–Ω–∞—è –∫–Ω–∏–≥–∞ üìá
### (10-15 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Klaus –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç inventory

**11:45 ‚Äî Organizing servers**

**Klaus:**
> *"50 servers. –ö–∞–∫ Ansible –∑–Ω–∞–µ—Ç –∫—É–¥–∞ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è? Inventory file. –≠—Ç–æ –∞–¥—Ä–µ—Å–Ω–∞—è –∫–Ω–∏–≥–∞."*

(Klaus –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `inventory.ini`)

```ini
[web]
web-01.example.com
web-02.example.com
web-03.example.com

[database]
db-01.example.com
db-02.example.com

[cache]
cache-01.example.com

[production:children]
web
database
cache
```

**Klaus:**
> *"Groups. Web servers –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ. Databases –≤ –¥—Ä—É–≥–æ–π. –ú–æ–∂–µ—à—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≥—Ä—É–ø–ø—É —Ü–µ–ª–∏–∫–æ–º. –û–¥–∏–Ω playbook, —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏."*

**LILITH:**
> *"Inventory ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ. –ì—Ä—É–ø–ø—ã = '–†–∞–±–æ—Ç–∞', '–°–µ–º—å—è', '–î—Ä—É–∑—å—è'. –•–æ—á–µ—à—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å –≤—Å–µ–º –∫–æ–ª–ª–µ–≥–∞–º? –í—ã–±–∏—Ä–∞–µ—à—å –≥—Ä—É–ø–ø—É '–†–∞–±–æ—Ç–∞'. Ansible —Ç–æ –∂–µ —Å–∞–º–æ–µ."*

---

### üìö –¢–µ–æ—Ä–∏—è: Inventory Structure

**Inventory file** = list of servers + groups

**Basic format (INI):**

```ini
# Individual servers
server1.example.com
server2.example.com

# Groups
[webservers]
web1.example.com
web2.example.com

[databases]
db1.example.com
db2.example.com

# Group of groups (meta-group)
[production:children]
webservers
databases

# Variables for group
[webservers:vars]
nginx_port=80
ssl_enabled=true
```

**YAML format (alternative):**

```yaml
all:
  children:
    webservers:
      hosts:
        web1.example.com:
        web2.example.com:
      vars:
        nginx_port: 80
    databases:
      hosts:
        db1.example.com:
```

---

### üí° –ú–µ—Ç–∞—Ñ–æ—Ä–∞: Inventory = Phone Contacts

```
üìá Phone Contacts (Inventory)

üë• Work (webservers group)
   ‚îú‚îÄ Alice (web1.example.com)
   ‚îú‚îÄ Bob (web2.example.com)
   ‚îî‚îÄ Carol (web3.example.com)

üë®‚Äçüë©‚Äçüëß Family (database servers)
   ‚îú‚îÄ Mom (db-primary.com)
   ‚îî‚îÄ Dad (db-replica.com)

üéÆ Friends (cache servers)
   ‚îî‚îÄ Dave (cache1.example.com)

Want to call all Work contacts?
‚Üí Select "Work" group
‚Üí Group call! üìû

Want to configure all webservers?
‚Üí Select [webservers] group
‚Üí ansible-playbook -i inventory.ini webservers.yml
```

---

### üíª –ü—Ä–∞–∫—Ç–∏–∫–∞ 2: Create Inventory

```bash
cd ~/ansible-operation-shadow

# Create inventory file
cat > inventory.ini << 'EOF'
[web]
web-01 ansible_host=10.0.1.10
web-02 ansible_host=10.0.1.11
web-03 ansible_host=10.0.1.12

[database]
db-01 ansible_host=10.0.2.10
db-02 ansible_host=10.0.2.11

[cache]
cache-01 ansible_host=10.0.3.10

[production:children]
web
database
cache

[production:vars]
ansible_user=admin
ansible_ssh_private_key_file=~/.ssh/operation-shadow.pem
EOF

# Test inventory
ansible all -i inventory.ini --list-hosts
# Output: Lists all servers

# Ping specific group
ansible web -i inventory.ini -m ping
```

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 2

**–í–æ–ø—Ä–æ—Å 1:** –ó–∞—á–µ–º groups –≤ inventory?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Target specific server types.**

Without groups:
```bash
ansible server1,server2,server3 ...  # Manual list, tedious!
```

With groups:
```bash
ansible webservers ...  # All web servers automatically!
```

**Use cases:**
- Deploy nginx —Ç–æ–ª—å–∫–æ –Ω–∞ web servers
- Backup —Ç–æ–ª—å–∫–æ databases
- Restart —Ç–æ–ª—å–∫–æ cache servers

**Different configs for different roles.**

**Klaus:** *"Groups ‚Äî —ç—Ç–æ classification. Web servers –Ω—É–∂–µ–Ω nginx. Database servers –Ω—É–∂–µ–Ω PostgreSQL. Groups –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å."*

</details>

**–í–æ–ø—Ä–æ—Å 2:** –ß—Ç–æ —Ç–∞–∫–æ–µ `:children`?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Group of groups (meta-group).**

```ini
[web]
web1
web2

[database]
db1

[production:children]  # Meta-group
web
database

# Now "production" includes: web1, web2, db1
```

**Use case:**
```bash
# Configure ALL production servers
ansible production -m setup

# vs individual groups
ansible web -m setup
ansible database -m setup
```

**LILITH:** *"`:children` ‚Äî —ç—Ç–æ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –¥—Ä—É–≥–∏–µ –ø–∞–ø–∫–∏. 'Production' –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 'Web' –∏ 'Database' –ø–æ–¥–ø–∞–ø–∫–∏."*

</details>

---

## –¶–ò–ö–õ 3: Playbooks & Modules ‚Äî –†–µ—Ü–µ–ø—Ç –ø–æ–≤–∞—Ä–∞ üë®‚Äçüç≥
### (10-15 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Klaus's First Playbook

**12:15 ‚Äî Writing automation**

**Klaus:**
> *"Inventory ‚Äî —ç—Ç–æ –ì–î–ï. Playbook ‚Äî —ç—Ç–æ –ß–¢–û –¥–µ–ª–∞—Ç—å. Playbook –∫–∞–∫ —Ä–µ—Ü–µ–ø—Ç –ø–æ–≤–∞—Ä–∞."*

(Klaus —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—Å—Ç–æ–π playbook)

```yaml
---
- name: Configure web servers
  hosts: web
  become: yes
  
  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present
    
    - name: Start nginx
      service:
        name: nginx
        state: started
        enabled: yes
```

```bash
ansible-playbook -i inventory.ini webserver.yml
```

**3 web servers** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. Nginx —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∑–∞–ø—É—â–µ–Ω, enabled.

**Klaus:**
> *"Playbook = recipe. 'Install nginx, start nginx'. Modules = ingredients. `apt` module = package manager. `service` module = systemctl wrapper. 3000+ modules available."*

**LILITH:**
> *"Playbook ‚Äî —ç—Ç–æ —Ä–µ—Ü–µ–ø—Ç. Modules ‚Äî –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã. Chef (—Ç—ã) –ø–∏—à–µ—à—å —Ä–µ—Ü–µ–ø—Ç. Ansible (–∫—É—Ö–æ–Ω–Ω—ã–π —Ä–æ–±–æ—Ç) –≥–æ—Ç–æ–≤–∏—Ç. Servers (–æ–±–µ–¥—ã) –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏."*

---

### üìö –¢–µ–æ—Ä–∏—è: Playbook Syntax

**Playbook structure:**

```yaml
---  # YAML start
- name: Playbook description
  hosts: target_group  # From inventory
  become: yes  # Run as root (sudo)
  
  vars:  # Variables
    nginx_port: 80
  
  tasks:  # List of tasks
    - name: Task description
      module_name:  # Ansible module
        parameter1: value1
        parameter2: value2
    
    - name: Another task
      another_module:
        param: value
```

**Key components:**

1. **hosts:** Which servers (from inventory)
2. **become:** Run as superuser (sudo)
3. **vars:** Variables
4. **tasks:** List of actions
5. **modules:** Built-in Ansible functions

---

### üí° –ú–µ—Ç–∞—Ñ–æ—Ä–∞: Playbook = Recipe

```
üë®‚Äçüç≥ Cooking Recipe (Playbook)

Recipe: Chocolate Cake
Serves: 50 people (50 servers)

Ingredients (Modules):
‚îú‚îÄ Flour (apt module)
‚îú‚îÄ Eggs (copy module)
‚îú‚îÄ Sugar (service module)
‚îî‚îÄ Chocolate (template module)

Instructions (Tasks):
1. Mix flour and eggs (install packages)
2. Add sugar (configure files)
3. Bake at 350¬∞F (start services)
4. Cool down (enable on boot)

Result: 50 identical cakes (50 configured servers)
```

**Chef (you):** Writes recipe
**Kitchen robot (Ansible):** Executes recipe
**Diners (users):** Enjoy consistent meals

---

### üìñ Popular Modules

**Package management:**
```yaml
- name: Install package
  apt:  # Debian/Ubuntu
    name: nginx
    state: present

- name: Remove package
  yum:  # RedHat/CentOS
    name: httpd
    state: absent
```

**File operations:**
```yaml
- name: Copy file
  copy:
    src: /local/file.txt
    dest: /remote/file.txt
    mode: '0644'

- name: Create directory
  file:
    path: /opt/app
    state: directory
    owner: www-data
```

**Service management:**
```yaml
- name: Start service
  service:
    name: nginx
    state: started
    enabled: yes  # Start on boot
```

**Command execution:**
```yaml
- name: Run command
  command: /usr/bin/custom-script.sh
  
- name: Run shell command
  shell: echo "Hello" > /tmp/file.txt
```

---

### üíª –ü—Ä–∞–∫—Ç–∏–∫–∞ 3: First Playbook

```yaml
# webserver.yml
---
- name: Configure web servers
  hosts: web
  become: yes
  
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
    
    - name: Install nginx
      apt:
        name: nginx
        state: present
    
    - name: Copy index.html
      copy:
        content: |
          <html>
            <body>
              <h1>Operation Shadow - Web Server</h1>
              <p>Configured by Ansible</p>
            </body>
          </html>
        dest: /var/www/html/index.html
    
    - name: Start nginx
      service:
        name: nginx
        state: started
        enabled: yes
```

```bash
# Run playbook
ansible-playbook -i inventory.ini webserver.yml

# Check result
curl http://web-01
```

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 3

**–í–æ–ø—Ä–æ—Å 1:** –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É playbook –∏ module?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:**

**Playbook** = Recipe (full instructions)
**Module** = Ingredient/Tool (one specific action)

```yaml
# Playbook (recipe)
- name: Bake cake
  tasks:
    - name: Mix ingredients  ‚Üê Module (apt)
    - name: Bake             ‚Üê Module (service)
    - name: Decorate         ‚Üê Module (template)
```

**Playbook** = YAML file with many tasks
**Module** = One task (apt, copy, service, etc.)

**Klaus:** *"Playbook orchestrates. Modules execute."*

</details>

**–í–æ–ø—Ä–æ—Å 2:** –ó–∞—á–µ–º `become: yes`?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Run as superuser (sudo).**

```yaml
# Without become
- name: Install nginx
  apt:
    name: nginx
  # ‚ùå FAIL: Permission denied (normal user can't install packages)

# With become
- name: Install nginx
  become: yes  # Run as root
  apt:
    name: nginx
  # ‚úÖ SUCCESS: root can install packages
```

**become** = `sudo` prefix

**LILITH:** *"`become: yes` ‚Äî —ç—Ç–æ Ansible –≥–æ–≤–æ—Ä–∏—Ç 'I need admin –ø—Ä–∞–≤–∞'. –ö–∞–∫ `sudo` –ø–µ—Ä–µ–¥ –∫–æ–º–∞–Ω–¥–æ–π."*

</details>

---

## –¶–ò–ö–õ 4: Roles ‚Äî Lego Blueprints üß±
### (10-15 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Klaus –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**13:00 ‚Äî Reusable configurations**

**Klaus:**
> *"50 web servers. –í—Å–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ. –ó–∞—á–µ–º –ø–∏—Å–∞—Ç—å playbook 50 —Ä–∞–∑? Roles. Lego blueprints. –°–æ–∑–¥–∞–ª —Ä–æ–ª—å 'webserver' ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –≤–µ–∑–¥–µ."*

(Klaus –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–æ–ª–µ–π)

```
roles/
‚îú‚îÄ‚îÄ webserver/
‚îÇ   ‚îú‚îÄ‚îÄ tasks/main.yml      # What to do
‚îÇ   ‚îú‚îÄ‚îÄ handlers/main.yml   # Restart services
‚îÇ   ‚îú‚îÄ‚îÄ templates/nginx.j2  # Config templates
‚îÇ   ‚îî‚îÄ‚îÄ defaults/main.yml   # Default variables
‚îî‚îÄ‚îÄ database/
    ‚îú‚îÄ‚îÄ tasks/main.yml
    ‚îî‚îÄ‚îÄ templates/postgresql.conf.j2
```

**Klaus:**
> *"Role = reusable package. Web servers –Ω—É–∂–Ω–∞ —Ä–æ–ª—å 'webserver'. Database servers ‚Äî —Ä–æ–ª—å 'database'. DRY principle."*

**LILITH:**
> *"Roles ‚Äî —ç—Ç–æ Lego blueprints. –°–æ–∑–¥–∞–ª blueprint –¥–ª—è –±–∞—à–Ω–∏ ‚Äî –º–æ–∂–µ—à—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å 100 –±–∞—à–µ–Ω. –ù–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –∫–∞–∂–¥—ã–π —Ä–∞–∑. Ansible roles = code reusability."*

---

### üìö –¢–µ–æ—Ä–∏—è: Ansible Roles

**Role structure:**

```
roles/webserver/
‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml        # Tasks (install, configure, start)
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml        # Handlers (restart on change)
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf.j2   # Jinja2 templates
‚îú‚îÄ‚îÄ files/
‚îÇ   ‚îî‚îÄ‚îÄ index.html      # Static files
‚îú‚îÄ‚îÄ vars/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml        # Variables
‚îú‚îÄ‚îÄ defaults/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml        # Default variables
‚îî‚îÄ‚îÄ meta/
    ‚îî‚îÄ‚îÄ main.yml        # Role metadata
```

**Using roles in playbook:**

```yaml
---
- name: Configure all servers
  hosts: all
  roles:
    - common          # Everyone gets this
    
- name: Configure web servers
  hosts: web
  roles:
    - webserver       # Only web servers

- name: Configure databases
  hosts: database
  roles:
    - database        # Only db servers
```

---

### üí° "Aha!" –º–æ–º–µ–Ω—Ç: Idempotence

**Idempotence** = running multiple times = same result

```bash
# Run playbook first time
ansible-playbook playbook.yml
# Output: changed=10 (10 tasks modified something)

# Run again immediately
ansible-playbook playbook.yml
# Output: changed=0 (nothing to change, already correct!)
```

**Why?**

Modules check current state:
```yaml
- name: Install nginx
  apt:
    name: nginx
    state: present

# First run: nginx not installed ‚Üí INSTALL (changed)
# Second run: nginx already installed ‚Üí SKIP (ok)
```

**LILITH:**
> *"Idempotence ‚Äî —ç—Ç–æ –∫–∞–∫ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—å —Å–≤–µ—Ç–∞. –ù–∞–∂–∞–ª '–≤–∫–ª—é—á–∏—Ç—å' 10 —Ä–∞–∑ ‚Äî —Å–≤–µ—Ç –≤–∫–ª—é—á—ë–Ω (–Ω–µ 10 —Ä–∞–∑ —è—Ä—á–µ!). Ansible –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –£–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ? –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç."*

---

### üíª –ü—Ä–∞–∫—Ç–∏–∫–∞ 4: Create Role

```bash
# Create role structure
ansible-galaxy init roles/webserver

# Edit roles/webserver/tasks/main.yml
cat > roles/webserver/tasks/main.yml << 'EOF'
---
- name: Install nginx
  apt:
    name: nginx
    state: present

- name: Copy config
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: restart nginx  # Trigger handler

- name: Start nginx
  service:
    name: nginx
    state: started
    enabled: yes
EOF

# Create handler
cat > roles/webserver/handlers/main.yml << 'EOF'
---
- name: restart nginx
  service:
    name: nginx
    state: restarted
EOF

# Use role in playbook
cat > site.yml << 'EOF'
---
- name: Configure infrastructure
  hosts: web
  roles:
    - webserver
EOF

# Run
ansible-playbook -i inventory.ini site.yml
```

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 4

**–í–æ–ø—Ä–æ—Å 1:** –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å playbook 2 —Ä–∞–∑–∞?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Second run: changed=0 (idempotence)**

```bash
# First run
ansible-playbook playbook.yml
PLAY RECAP:
server-01  ok=10  changed=10  failed=0  # 10 changes made

# Second run (immediately)
ansible-playbook playbook.yml
PLAY RECAP:
server-01  ok=10  changed=0  failed=0  # 0 changes (already correct!)
```

**Ansible checks state:**
- nginx already installed? ‚Üí skip install
- config already correct? ‚Üí skip copy
- service already running? ‚Üí skip start

**Safe to run repeatedly!**

**Klaus:** *"Idempotence = safety. Can run 100 times. Won't break anything."*

</details>

**–í–æ–ø—Ä–æ—Å 2:** –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å roles –≤–º–µ—Å—Ç–æ playbooks?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Reusability + Organization.**

**Without roles (playbook):**
```yaml
# webserver1.yml
- tasks:
    - install nginx
    - configure nginx
    - start nginx

# webserver2.yml
- tasks:
    - install nginx  # DUPLICATE CODE!
    - configure nginx
    - start nginx
```

**With roles:**
```yaml
# roles/webserver/tasks/main.yml (once)
- install nginx
- configure nginx
- start nginx

# Use everywhere
- hosts: web1
  roles: [webserver]
- hosts: web2
  roles: [webserver]
```

**DRY: Don't Repeat Yourself!**

**LILITH:** *"Roles ‚Äî —ç—Ç–æ functions –≤ programming. –ù–∞–ø–∏—Å–∞–ª —Ñ—É–Ω–∫—Ü–∏—é ‚Äî –≤—ã–∑—ã–≤–∞–µ—à—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ. Don't copy-paste –∫–æ–¥."*

</details>

---

## –¶–ò–ö–õ 5: TWIST ‚Äî Certificate Expired (Security Audit) üîç
### (15-20 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Unexpected Discovery

**16:30 ‚Äî During playbook execution**

Max –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π playbook. –í—Å—ë –∏–¥—ë—Ç –≥–ª–∞–¥–∫–æ. Tasks –∑–µ–ª—ë–Ω—ã–µ.

**Suddenly:**

```
TASK [Copy SSL certificates] ***********************************
changed: [server-27]

TASK [Verify certificate validity] *****************************
FAILED: [server-27]
  Certificate expired: 2024-11-15
  Certificate CN: operation-shadow.net
  Issued by: Let's Encrypt
  Days expired: 362 days
```

**Max (confused):**
> *"Certificate expired?! –ì–æ–¥ –Ω–∞–∑–∞–¥?!"*

**Klaus (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç):**
> *"Server-27... —ç—Ç–æ production load balancer. Expired certificate –≥–æ–¥ –Ω–∞–∑–∞–¥. –ö–∞–∫ —ç—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–º–µ—Ç–∏–ª?!"*

**Dmitry (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ):**
> *"–ü—Ä–æ–≤–µ—Ä—è—é –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä—ã... Server-31 —Ç–æ–∂–µ expired. Server-42 expires —á–µ—Ä–µ–∑ 3 –¥–Ω—è!"*

**Klaus (—Å–µ—Ä—å—ë–∑–Ω–æ):**
> *"Audit time. Ansible –Ω–∞—à—ë–ª —Ç–æ, —á—Ç–æ monitoring –ø—Ä–æ–ø—É—Å—Ç–∏–ª. –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å—ë."*

---

### üìö –¢–µ–æ—Ä–∏—è: Ansible as Audit Tool

**Ansible –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è configuration. –¢–∞–∫–∂–µ –¥–ª—è AUDIT:**

```yaml
# Certificate audit playbook
- name: Audit SSL certificates
  hosts: all
  tasks:
    - name: Find all certificates
      find:
        paths: /etc/ssl/certs
        patterns: "*.crt"
      register: certs
    
    - name: Check expiration
      command: >
        openssl x509 -in {{ item.path }}
        -noout -enddate
      loop: "{{ certs.files }}"
      register: cert_expiry
    
    - name: Report expired
      debug:
        msg: "{{ item.item.path }} expires {{ item.stdout }}"
      loop: "{{ cert_expiry.results }}"
      when: "'EXPIRED' in item.stdout or days_until_expiry < 30"
```

**Klaus runs audit:**

```bash
ansible-playbook -i inventory.ini cert-audit.yml

# Output:
# server-27: ‚ùå Expired 362 days ago
# server-31: ‚ùå Expired 180 days ago
# server-42: ‚ö†Ô∏è  Expires in 3 days
# server-15: ‚ö†Ô∏è  Expires in 15 days
# (46 servers: ‚úÖ Valid)
```

---

### üí° Security Discovery

**Emergency response:**

1. **Identify scope** (4 servers affected)
2. **Generate new certificates** (Let's Encrypt)
3. **Deploy via Ansible** (automated!)
4. **Update monitoring** (add cert expiry checks)

**16:45 - 17:15 ‚Äî Emergency Fix**

```yaml
# emergency-cert-renewal.yml
- name: Emergency certificate renewal
  hosts: expired_certs
  become: yes
  tasks:
    - name: Install certbot
      apt:
        name: certbot
        state: present
    
    - name: Renew certificates
      command: >
        certbot renew --force-renewal
        --non-interactive
        --agree-tos
        --email admin@operation-shadow.net
    
    - name: Restart nginx
      service:
        name: nginx
        state: restarted
```

```bash
ansible-playbook emergency-cert-renewal.yml
# 4 servers renewed, 30 seconds
```

**17:15 ‚Äî Resolution**

**Klaus:**
> *"4 servers fixed. Certificates renewed. Valid for 90 days. –≠—Ç–æ —É—Ä–æ–∫: Ansible –Ω–µ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è. –¢–∞–∫–∂–µ discovery. –ù–∞—à—ë–ª –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ monitoring –ø—Ä–æ–ø—É—Å—Ç–∏–ª."*

**Anna (–≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫, forensics):**
> *"Certificate expired –≥–æ–¥ –Ω–∞–∑–∞–¥, –Ω–æ HTTPS –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–ª? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ load balancer. –í–æ–∑–º–æ–∂–Ω–æ, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π cert –∏–ª–∏ fallback. Investigating..."*

**(–ê–Ω–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç: load balancer –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—Ç–∞—Ä—ã–π cached cert + –æ—à–∏–±–∫–∞ –≤ monitoring config ‚Äî cert expiry checks –±—ã–ª–∏ disabled –ø–æ—Å–ª–µ migration)**

**Anna:**
> *"Found it. Monitoring cert checks disabled during migration 18 months ago. Never re-enabled. Added to post-incident checklist."*

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 5

**–í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ Ansible –Ω–∞—à—ë–ª expired certificates?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Automated audit playbook.**

```yaml
# Audit task checks ALL servers
- name: Verify certificate validity
  command: openssl x509 -in /etc/ssl/cert.pem -noout -checkend 0
  register: cert_check
  failed_when: cert_check.rc != 0
```

**Manual audit:**
- SSH to 50 servers individually
- Run `openssl x509` command
- Check dates manually
- 2-3 hours work

**Ansible audit:**
- One playbook
- All servers checked in parallel
- 2 minutes

**LILITH:** *"Ansible = automated inspector. Checks –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã, finds inconsistencies. Humans make mistakes. Automation doesn't."*

</details>

**–í–æ–ø—Ä–æ—Å 2:** –ü–æ—á–µ–º—É monitoring –ø—Ä–æ–ø—É—Å—Ç–∏–ª expired cert?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **Cert expiry checks were disabled.**

**Root cause:**
- Migration 18 months ago
- Cert monitoring temporarily disabled
- Never re-enabled
- Fell through cracks

**Prevention:**
1. **Checklist:** Post-migration verification
2. **Automation:** Ansible checks certs on every run
3. **Redundancy:** Multiple monitoring layers

**LILITH:** *"Single point of failure. Monitoring disabled = blind spot. Always have backup checks. Defense in depth."*

</details>

---

## –¶–ò–ö–õ 6: Templates & Variables ‚Äî Mad Libs ‚úçÔ∏è
### (15-20 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Dynamic Configurations

**17:45 ‚Äî After cert fix**

**Klaus:**
> *"Certificates fixed. –¢–µ–ø–µ—Ä—å dynamic configs. 50 servers, —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. Templates. Jinja2. –ö–∞–∫ Mad Libs."*

(Klaus –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω nginx config)

```jinja2
# templates/nginx.conf.j2
server {
    listen {{ nginx_port }};
    server_name {{ server_name }};
    
    ssl_certificate {{ ssl_cert_path }};
    ssl_certificate_key {{ ssl_key_path }};
    
    {% if enable_ssl %}
    listen 443 ssl;
    {% endif %}
    
    location / {
        proxy_pass http://{{ backend_host }}:{{ backend_port }};
    }
}
```

**Klaus:**
> *"–®–∞–±–ª–æ–Ω. Variables –≤ –¥–≤–æ–π–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö. Ansible –∑–∞–ø–æ–ª–Ω—è–µ—Ç. –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—é –≤–µ—Ä—Å–∏—é."*

**LILITH:**
> *"Templates ‚Äî —ç—Ç–æ Mad Libs. 'My name is ___'. Fill in blank. Jinja2 template: 'server_name is {{ server_name }}'. Ansible fills in."*

---

### üìö –¢–µ–æ—Ä–∏—è: Jinja2 Templates

**Template syntax:**

```jinja2
{# Comment #}

{{ variable }}  # Variable substitution

{% if condition %}
  # Conditional block
{% endif %}

{% for item in list %}
  # Loop
{% endfor %}
```

**Example:**

```jinja2
# app.conf.j2
[app]
name = {{ app_name }}
port = {{ app_port }}
debug = {{ debug_mode | default('false') }}

{% if enable_ssl %}
ssl_cert = /etc/ssl/{{ app_name }}.crt
{% endif %}

{% for host in backend_servers %}
backend = {{ host }}
{% endfor %}
```

**Variables from:**
- Inventory (`ansible_host`, group_vars)
- Playbook (`vars:` section)
- Role defaults (`defaults/main.yml`)
- Command line (`-e "var=value"`)

---

### üíª –ü—Ä–∞–∫—Ç–∏–∫–∞ 6: Use Templates

```yaml
# playbook with template
- name: Configure nginx
  hosts: web
  vars:
    nginx_port: 80
    server_name: "{{ inventory_hostname }}"
    backend_host: "app.internal"
    backend_port: 8080
  
  tasks:
    - name: Deploy nginx config
      template:
        src: templates/nginx.conf.j2
        dest: /etc/nginx/sites-available/default
      notify: reload nginx
  
  handlers:
    - name: reload nginx
      service:
        name: nginx
        state: reloaded
```

```bash
ansible-playbook -i inventory.ini nginx-config.yml
```

**Result:** Each server gets customized config!

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 6

**–í–æ–ø—Ä–æ—Å 1:** –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `copy` –∏ `template` module?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:**

**copy:** Static file (exact copy)
```yaml
- copy:
    src: file.txt
    dest: /remote/file.txt
# Same file on all servers
```

**template:** Dynamic file (variables replaced)
```yaml
- template:
    src: app.conf.j2
    dest: /etc/app.conf
# Different file per server (variables filled in)
```

**Klaus:** *"`copy` = photocopy (exact). `template` = Mad Libs (fill blanks)."*

</details>

---

## –¶–ò–ö–õ 7: Vault & Secrets ‚Äî –°–µ–π—Ñ üîê
### (10-15 –º–∏–Ω—É—Ç)

### üé¨ –°—é–∂–µ—Ç: Encrypting Secrets

**18:15 ‚Äî Security best practice**

**Klaus:**
> *"Playbooks –≤ Git. –ù–æ passwords —Ç–æ–∂–µ –≤ Git? –ù–ï–¢! Ansible Vault. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ."*

(Klaus —Å–æ–∑–¥–∞—ë—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª)

```bash
ansible-vault create secrets.yml
# Enter password: ********

# Edit encrypted file
cat > secrets.yml << EOF
database_password: SuperSecret123
api_key: abc123xyz789
ssl_private_key: |
  -----BEGIN PRIVATE KEY-----
  ...
  -----END PRIVATE KEY-----
EOF
```

**Klaus:**
> *"–¢–µ–ø–µ—Ä—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω. –ú–æ–∂–µ—à—å –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git. Decrypt —Ç–æ–ª—å–∫–æ —Å –ø–∞—Ä–æ–ª–µ–º."*

**LILITH:**
> *"Vault ‚Äî —ç—Ç–æ —Å–µ–π—Ñ. Secrets –≤–Ω—É—Ç—Ä–∏ —Å–µ–π—Ñ–∞. –ö–æ–¥ –≤ Git (public). –°–µ–π—Ñ –≤ Git (encrypted). –¢–æ–ª—å–∫–æ —Ç—ã –∑–Ω–∞–µ—à—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é (vault password)."*

---

### üìö –¢–µ–æ—Ä–∏—è: Ansible Vault

**Operations:**

```bash
# Create encrypted file
ansible-vault create secrets.yml

# Edit encrypted file
ansible-vault edit secrets.yml

# Encrypt existing file
ansible-vault encrypt passwords.txt

# Decrypt file
ansible-vault decrypt secrets.yml

# View encrypted file
ansible-vault view secrets.yml

# Change vault password
ansible-vault rekey secrets.yml
```

**Using vault in playbook:**

```bash
# Prompt for password
ansible-playbook --ask-vault-pass playbook.yml

# Password from file
ansible-playbook --vault-password-file ~/.vault_pass playbook.yml
```

---

### üíª –ü—Ä–∞–∫—Ç–∏–∫–∞ 7: Encrypt Secrets

```bash
# Create vault
ansible-vault create group_vars/all/vault.yml

# Add secrets
database_password: secret123
api_token: xyz789

# Use in playbook
- name: Configure database
  hosts: database
  vars_files:
    - group_vars/all/vault.yml
  tasks:
    - name: Create database user
      postgresql_user:
        name: app_user
        password: "{{ database_password }}"  # From vault!
```

---

### ü§î –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è: –¶–∏–∫–ª 7

**–í–æ–ø—Ä–æ—Å 1:** –ú–æ–∂–Ω–æ –ª–∏ –∫–æ–º–º–∏—Ç–∏—Ç—å vault —Ñ–∞–π–ª –≤ Git?

<details>
<summary>–î—É–º–∞–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π</summary>

**–û—Ç–≤–µ—Ç:** **–î–ê! –û–Ω –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω.**

```bash
# Encrypted vault file (safe to commit)
$ANSIBLE_VAULT;1.1;AES256
61363966386662356537653...
# Gibberish without password

# Git
git add secrets.yml  # ‚úÖ Safe! Encrypted
git commit -m "Add encrypted secrets"
git push  # ‚úÖ Safe! Cannot be read without password
```

**Password –ù–ï –≤ Git!** Store separately (password manager, environment variable).

**LILITH:** *"–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ–π—Ñ –º–æ–∂–µ—à—å –ø–æ–ª–æ–∂–∏—Ç—å –≥–¥–µ —É–≥–æ–¥–Ω–æ. –ë–µ–∑ –∫–ª—é—á–∞ ‚Äî –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω."*

</details>

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
episode-16-ansible-iac/
‚îú‚îÄ‚îÄ README.md                  # –¢–µ–æ—Ä–∏—è + micro-cycles
‚îú‚îÄ‚îÄ artifacts/
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ starter/                   # üéØ –ù–ê–ß–ù–ò –ó–î–ï–°–¨!
‚îÇ   ‚îú‚îÄ‚îÄ inventory.ini          # 50 servers inventory
‚îÇ   ‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ site.yml           # Main playbook
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cert-audit.yml     # Certificate audit
‚îÇ   ‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webserver/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring/
‚îÇ   ‚îú‚îÄ‚îÄ group_vars/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ all/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ vars.yml
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ solution/                  # –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ test.sh
```

---

## üí¨ –¶–∏—Ç–∞—Ç—ã Episode 16

**Klaus Schmidt:**
> "Configuration management is not about managing servers. It's about managing chaos."

> "Ansible ‚Äî —ç—Ç–æ –¥–∏—Ä–∏–∂—ë—Ä –æ—Ä–∫–µ—Å—Ç—Ä–∞. –û–¥–∏–Ω –¥–∏—Ä–∏–∂—ë—Ä, 50 –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤. –ë–µ–∑ –¥–∏—Ä–∏–∂—ë—Ä–∞ ‚Äî —Ö–∞–æ—Å."

> "Idempotence = safety. Can run 100 times. Won't break anything."

**LILITH:**
> "Ansible ‚Äî —ç—Ç–æ –¥–∏—Ä–∏–∂—ë—Ä –¥–ª—è servers. –û–¥–∏–Ω –¥–∏—Ä–∏–∂—ë—Ä, 50 –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤. –ë–µ–∑ –¥–∏—Ä–∏–∂—ë—Ä–∞ ‚Äî —Ö–∞–æ—Å. –° –¥–∏—Ä–∏–∂—ë—Ä–æ–º ‚Äî —Å–∏–º—Ñ–æ–Ω–∏—è."

> "Agentless ‚Äî —ç—Ç–æ –∫—Ä–∞—Å–∏–≤–æ. Puppet —Ç—Ä–µ–±—É–µ—Ç agent. Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSH. SSH —É–∂–µ –≤–µ–∑–¥–µ."

> "Playbook ‚Äî —ç—Ç–æ —Ä–µ—Ü–µ–ø—Ç. Modules ‚Äî –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã. Ansible ‚Äî –∫—É—Ö–æ–Ω–Ω—ã–π —Ä–æ–±–æ—Ç. Servers ‚Äî –≥–æ—Ç–æ–≤—ã–µ –æ–±–µ–¥—ã."

---

## üéì –ß—Ç–æ –≤—ã —É–∑–Ω–∞–ª–∏

–ü–æ—Å–ª–µ Episode 16 –≤—ã —É–º–µ–µ—Ç–µ:

‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Ansible (control node)
‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å inventory (groups, variables)
‚úÖ –ü–∏—Å–∞—Ç—å playbooks (tasks, modules)
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å roles (reusable configs)
‚úÖ Templates (Jinja2 for dynamic configs)
‚úÖ Handlers (restart services on change)
‚úÖ Ansible Vault (encrypt secrets)
‚úÖ Audit infrastructure (certificate checks, compliance)
‚úÖ **SEASON 4 COMPLETE!** üéâ

**Key concepts:**
- **Agentless:** SSH only, no agent installation
- **Idempotent:** Safe to run multiple times
- **Declarative:** Describe WHAT, not HOW
- **Roles:** Reusable configurations
- **Vault:** Encrypted secrets

---

## üèÜ SEASON 4 FINALE ‚Äî –ò—Ç–æ–≥–∏

**Episodes completed:**
- Episode 13: Git & Version Control ‚úÖ
- Episode 14: Docker Basics ‚úÖ
- Episode 15: CI/CD Pipelines ‚úÖ
- Episode 16: Ansible & IaC ‚úÖ

**Skills mastered:**
- Version control (Git)
- Containerization (Docker)
- Continuous Deployment (GitHub Actions)
- Configuration Management (Ansible)

**DevOps journey:** Complete! üöÄ

**Viktor (final video call, day 32):**
> *"Max, Dmitry. Season 4 complete. Git, Docker, CI/CD, Ansible ‚Äî –≤—Å—è automation –≥–æ—Ç–æ–≤–∞. 50 servers —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π. Infrastructure as Code —Ä–∞–±–æ—Ç–∞–µ—Ç. –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: Security. Season 5. Z√ºrich, Switzerland. Penetration testing, security audits, hardening. See you there."*

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**SEASON 5 PREMIERE ‚Äî Episode 17: Security Auditing**
**Location:** üá®üá≠ Z√ºrich, Switzerland
**Focus:** Penetration testing, security hardening, compliance

**Eva Zimmerman (new character, security expert):**
> *"You built the infrastructure. Now we break it. Pentesting. Vulnerability scanning. Hardening. See you in Z√ºrich. ‚Äî Eva"*

---

<div align="center">

**üé¨ SEASON 4: DEVOPS AUTOMATION ‚Äî COMPLETE! üéâ**

*"Configuration management is not about managing servers. It's about managing chaos."*

üá©üá™ Berlin ‚Üí üá≥üá± Amsterdam ‚Ä¢ 4 Episodes ‚Ä¢ Klaus Schmidt ‚Ä¢ Ansible Architecture

**SEASON 4 FINALE!**

[‚¨ÖÔ∏è Episode 15: CI/CD](../episode-15-cicd-pipelines/README.md) | [‚¨ÜÔ∏è Season 4 Overview](../README.md) | [‚û°Ô∏è Season 5 Premiere](../../season-5-security/)

</div>

