#!/bin/bash

################################################################################
# OPERATION KERNEL SHADOWS - Episode 02
# Server Monitoring Script - STARTER TEMPLATE
# Author: Max Sokolov
# Date: 04 October 2025
#
# –û–ø–∏—Å–∞–Ω–∏–µ:
#   –≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è Episode 02.
#   –ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ–ø—É—Å–∫–∏, —Å–ª–µ–¥—É—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ README.md
#
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
#   ./starter.sh
#
# –®–∞–≥–∏:
#   1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π set -euo pipefail
#   2. –û–ø—Ä–µ–¥–µ–ª–∏ —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
#   3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π —Å—á—ë—Ç—á–∏–∫–∏
#   4. –ó–∞–ø–æ–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ TODO)
#   5. –í—ã–∑–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ main()
#   6. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º: chmod +x starter.sh
################################################################################

# TODO: –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º
# set -euo pipefail

# TODO: –û–ø—Ä–µ–¥–µ–ª–∏ —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
# GREEN='\033[0;32m'
# RED='\033[0;31m'
# YELLOW='\033[1;33m'
# BLUE='\033[0;34m'
# NC='\033[0m'

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
readonly SERVERS_FILE="artifacts/servers.txt"
readonly LOG_FILE="monitor.log"
readonly ALERT_FILE="alerts.txt"

# TODO: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π —Å—á—ë—Ç—á–∏–∫–∏
# total_servers=0
# online_servers=0
# offline_servers=0

################################################################################
# –§—É–Ω–∫—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
#   $1 - IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
#   0 - —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
#   1 - —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
#
# TODO: –ò—Å–ø–æ–ª—å–∑—É–π ping –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
# –ü–æ–¥—Å–∫–∞–∑–∫–∞: ping -c 1 -W 2 "$server_ip" &>/dev/null
################################################################################
check_server_status() {
    local server_ip="$1"

    # YOUR CODE HERE
    # –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ ping
    # –í–µ—Ä–Ω–∏ 0 –µ—Å–ª–∏ online, 1 –µ—Å–ª–∏ offline

    return 0
}

################################################################################
# –§—É–Ω–∫—Ü–∏—è: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª —Å timestamp
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
#   $1 - —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
#
# TODO: –î–æ–±–∞–≤—å timestamp —á–µ—Ä–µ–∑ date '+%Y-%m-%d %H:%M:%S'
# TODO: –ó–∞–ø–∏—à–∏ –≤ LOG_FILE —á–µ—Ä–µ–∑ >>
################################################################################
log_to_file() {
    local message="$1"

    # YOUR CODE HERE
    # local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    # echo "[$timestamp] $message" >> "$LOG_FILE"
}

################################################################################
# –§—É–Ω–∫—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
#   $1 - —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞
#
# TODO: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ log_to_file, –Ω–æ –≤ ALERT_FILE —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "ALERT:"
################################################################################
add_alert() {
    local message="$1"

    # YOUR CODE HERE
}

################################################################################
# –§—É–Ω–∫—Ü–∏—è: –≤—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å —Ü–≤–µ—Ç–æ–º
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
#   $1 - –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞
#   $2 - IP –∞–¥—Ä–µ—Å
#   $3 - —Å—Ç–∞—Ç—É—Å (online/offline)
#
# TODO: –ò—Å–ø–æ–ª—å–∑—É–π echo -e –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
# –ü—Ä–∏–º–µ—Ä: echo -e "${GREEN}‚úÖ${NC} $server_name ‚Äî ONLINE"
################################################################################
print_status() {
    local server_name="$1"
    local server_ip="$2"
    local status="$3"

    # YOUR CODE HERE
    # if [[ "$status" == "online" ]]; then
    #     echo -e "${GREEN}‚úÖ${NC} $server_name ($server_ip) ‚Äî ${GREEN}ONLINE${NC}"
    # else
    #     echo -e "${RED}‚ùå${NC} $server_name ($server_ip) ‚Äî ${RED}OFFLINE${NC}"
    # fi
}

################################################################################
# –§—É–Ω–∫—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
#
# TODO: –†–µ–∞–ª–∏–∑—É–π —Å–ª–µ–¥—É—é—â—É—é –ª–æ–≥–∏–∫—É:
#   1. –ü—Ä–æ–≤–µ—Ä—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ SERVERS_FILE —á–µ—Ä–µ–∑ [[ -f "$SERVERS_FILE" ]]
#   2. –û—á–∏—Å—Ç–∏ ALERT_FILE —á–µ—Ä–µ–∑ > "$ALERT_FILE"
#   3. –ß–∏—Ç–∞–π —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ —á–µ—Ä–µ–∑ while IFS= read -r line; do ... done < "$SERVERS_FILE"
#   4. –ü—Ä–æ–ø—É—Å–∫–∞–π –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: [[ -z "$line" || "$line" =~ ^# ]] && continue
#   5. –ü–∞—Ä—Å–∏—Ä—É–π –∏–º—è –∏ IP —á–µ—Ä–µ–∑ awk: server_name=$(echo "$line" | awk '{print $1}')
#   6. –í—ã–∑–æ–≤–∏ check_server_status "$server_ip"
#   7. –í—ã–∑–æ–≤–∏ print_status –∏ log_to_file
#   8. –û–±–Ω–æ–≤–∏ —Å—á—ë—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ ((total_servers++))
################################################################################
check_all_servers() {
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë    KERNEL SHADOWS - Server Monitoring         ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo ""

    # YOUR CODE HERE
    # 1. –ü—Ä–æ–≤–µ—Ä—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    # 2. –ß–∏—Ç–∞–π —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
    # 3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:
    #    - –í—ã–∑–æ–≤–∏ check_server_status
    #    - –í—ã–∑–æ–≤–∏ print_status
    #    - –ó–∞–ª–æ–≥–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    #    - –û–±–Ω–æ–≤–∏ —Å—á—ë—Ç—á–∏–∫–∏
}

################################################################################
# –§—É–Ω–∫—Ü–∏—è: –≤—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
#
# TODO: –í—ã–≤–µ–¥–∏:
#   - –í—Å–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–æ–≤: $total_servers
#   - –û–Ω–ª–∞–π–Ω: $online_servers (–∑–µ–ª—ë–Ω—ã–º —Ü–≤–µ—Ç–æ–º)
#   - –û—Ñ—Ñ–ª–∞–π–Ω: $offline_servers (–∫—Ä–∞—Å–Ω—ã–º –µ—Å–ª–∏ > 0)
#   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
################################################################################
print_statistics() {
    echo ""
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"

    # YOUR CODE HERE
    # –í—ã–≤–µ–¥–∏: total, online, offline
    # –î–æ–±–∞–≤—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ offline_servers > 0
}

################################################################################
# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
################################################################################
main() {
    # TODO: –í—ã–∑–æ–≤–∏ check_all_servers
    # YOUR CODE HERE

    # TODO: –í—ã–∑–æ–≤–∏ print_statistics
    # YOUR CODE HERE

    # TODO: –í–µ—Ä–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π exit code
    # if [[ $offline_servers -gt 0 ]]; then
    #     exit 1  # –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
    # else
    #     exit 0  # –í—Å—ë –û–ö
    # fi

    exit 0
}

################################################################################
# –ó–∞–ø—É—Å–∫
################################################################################
main "$@"
